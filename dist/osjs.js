"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.Compability=OSjs.Compability||{};OSjs.Helpers=OSjs.Helpers||{};OSjs.Handlers=OSjs.Handlers||{};OSjs.Settings=OSjs.Settings||{};OSjs.Applications=OSjs.Applications||{};OSjs.Dialogs=OSjs.Dialogs||{};OSjs.GUI=OSjs.GUI||{};OSjs.Locale=OSjs.Locale||{};OSjs.Core={};OSjs.API={};OSjs.Version="2.0-alpha2";var A=[];var s;var p;var w;var c;var q;var k;var a;var f=true;var u=300;var b=(function(){var E=1;var D=100000;return function(F){if(typeof F!=="undefined"&&F===true){return(D+=2)}return(E+=2)}})();function n(D){OSjs.GUI.blurMenu();D.stopPropagation();return false}function z(){return{top:0,left:0,width:window.innerWidth,height:window.innerHeight}}function g(){if(s){return s.getWindowSpace()}return z()}function v(D,E,F,G){q.style.display="block";return c.callAPI(D,E,function(){q.style.display="none";F.apply(this,arguments)},function(){q.style.display="none";G.apply(this,arguments)})}function j(J,H,E,F,G){if(c.getConfig("Core").BugReporting){G=typeof G=="undefined"?false:(G?true:false)}else{G=false}OSjs.GUI.blurMenu();if(s){try{var D=new OSjs.Dialogs.ErrorMessage();D.setError(J,H,E,F,G);s.addWindow(D);return D}catch(I){console.warn("An error occured while creating Dialogs.ErrorMessage",I);console.warn("stack",I.stack)}}alert(J+"\n\n"+H+"\n\n"+E);return null}function o(I,H,D){D=D||{};if(!I){throw"Cannot LaunchFile() without a filename"}if(!H){throw"Cannot LaunchFile() without a mime type"}var F={file:I,mime:H};if(D.args){for(var G in D.args){if(D.args.hasOwnProperty(G)){F[G]=D.args[G]}}}console.group("LaunchFile()");console.log("Filename",I);console.log("MIME",H);var E=function(K){console.info("Found",K.length,"applications supporting this mime");console.groupEnd();if(K.length){var J=function(L){if(L){e(L,F,D.onFinished,D.onError,D.onConstructed)}};if(K.length===1){J(K[0])}else{if(s){s.addWindow(new OSjs.Dialogs.ApplicationChooser(I,H,K,function(M,L,N){if(M!="ok"){return}J(L);c.setDefaultApplication(H,N?L:null)}))}else{OSjs.API.error(OSjs._("Error opening file"),OSjs._("The file '<span>{0}</span>' could not be opened",I),OSjs._("No window manager is running"))}}}else{OSjs.API.error(OSjs._("Error opening file"),OSjs._("The file '<span>{0}</span>' could not be opened",I),OSjs._("Could not find any Applications with support for '{0}' files",H))}};c.getApplicationNameByMime(H,I,D.forceList,E)}function e(L,F,E,H,T){F=F||{};E=E||function(){};H=H||function(){};T=T||function(){};if(!L){throw"Cannot LaunchProcess() witout a application name"}console.group("LaunchProcess()",L,F);var J=this;var R=null;var K=null;var M=function(X,Y){if(!R||!K){return}var W=Y?0:100;if(Y){W=(X/Y)*100}K.setProgress(W)};var V=function(Y){q.style.display="block";if(!Y.splash){return}R=document.createElement("div");R.className="ProcessSplash";var X=document.createElement("img");X.alt=L;X.src=OSjs.API.getIcon(Y.icon,Y);var W=document.createElement("b");W.appendChild(document.createTextNode(Y.name));var Z=document.createElement("span");Z.appendChild(document.createTextNode("Launching "));Z.appendChild(W);Z.appendChild(document.createTextNode("..."));K=new OSjs.GUI.ProgressBar("ApplicationSplash"+L);R.appendChild(X);R.appendChild(Z);R.appendChild(K.getRoot());document.body.appendChild(R)};var D=function(){if(K){K.destroy();K=null}if(R){if(R.parentNode){R.parentNode.removeChild(R)}R=null}};var G=function(X,W){D();console.groupEnd();j(OSjs._("Failed to launch Application"),OSjs._("An error occured while trying to launch: {0}",L),X,W,true);H(X,L,F)};var I=function(W){D();if(typeof OSjs.Applications[L]!="undefined"){var Y=(typeof W.singular==="undefined")?false:(W.singular===true);if(Y){var ab=w.getProcess(L,true);if(ab){console.debug("LaunchProcess()","detected that this application is a singular and already running...");if(ab instanceof C){ab._onMessage(null,"attention",F)}else{G(OSjs._("The application '{0}' is already launched and allows only one instance!",L))}return}}var X=null,Z=false;try{X=new OSjs.Applications[L](F,W);X.__sname=L;T(X,W)}catch(aa){console.warn("Error on constructing application",aa,aa.stack);G(OSjs._("Application '{0}' construct failed: {1}",L,aa),aa);Z=true}if(Z){if(X){try{X.destroy();X=null}catch(aa){console.warn("Something awful happened when trying to clean up failed launch Oo",aa)}}}else{try{c.getApplicationSettings(X.__name,function(ac){X.init(w,ac,W);E(X,W);console.groupEnd()})}catch(aa){console.warn("Error on init() application",aa,aa.stack);G(OSjs._("Application '{0}' init() failed: {1}",L,aa),aa)}}}else{G(OSjs._("Application resources missing for '{0}' or it failed to load!",L))}};var S=function(W){OSjs.Utils.Preload(W.preload,function(Y,Z,X){q.style.display="none";if(Z){G(OSjs._("Application '{0}' preloading failed: \n{1}",L,X.join(",")));return}setTimeout(function(){I(W)},0)},function(X,Y){M(X,Y)})};var U=c.getApplicationMetadata(L);if(!U){G(OSjs._("Failed to launch '{0}'. Application manifest data not found!",L));return}if(typeof U.compability!=="undefined"&&(U.compability instanceof Array)){var P=OSjs.Utils.getCompability();var Q;var O=[];for(var N=0;N<U.compability.length;N++){Q=U.compability[N];if(typeof P[Q]!=="undefiend"){if(!P[Q]){O.push(Q)}}}if(O.length){G(OSjs._("Failed to launch '{0}'. Your browser does not support: {1}",L,O.join(", ")));return}}V(U);S(U)}function m(I,J,G,F){I=I||[];J=J||function(){};G=G||function(){};F=F||function(){};var D=function(O,N,M,L,K){J(O,N,M,L,K);H()};var E=function(M,L,K){console.warn("LaunchProcessList() _onError()",M);G(M,L,K);H()};var H=function(){if(I.length){var M=I.pop();if(typeof M!=="object"){return}var L=M.name;var K=(typeof M.args==="undefined")?{}:(M.args||{});var N=M.data||{};if(!L){console.warn("LaunchProcessList() _onNext()","No application name defined");return}OSjs.API.launch(L,K,function(P,O){D(P,O,L,K,N)},function(Q,P,O){E(Q,P,O)})}else{F()}};H()}function i(E,F){if(!OSjs.Compability.audio){console.debug("PlaySound()","Browser has no support for sounds!");return false}if(c&&!c.getConfig("Core").Sounds){console.debug("PlaySound()","Core Config has disabled sounds!");return false}if(s&&!s.getSetting("enableSounds")){console.debug("PlaySound()","Window Manager has disabled sounds!");return false}if(typeof F==="undefined"){F=1}var G=OSjs.API.getThemeResource(E,"sound");console.info("PlaySound()",E,G);var D=new Audio(G);D.volume=F;D.play();return D}var d=(function(){var D=0;return function(E){this.__pid=D;this.__pname=E;this.__sname=E;this.__state=0;this.__started=new Date();this.__index=-1;console.group("OSjs::Core::Process::__construct()");console.log("pid",this.__pid);console.log("pname",this.__pname);console.log("started",this.__started);console.groupEnd();if(D>0){this.__index=A.push(this)-1}D++}})();d.prototype.destroy=function(D){D=(typeof D==="undefined")?true:(D===true);this.__state=-1;console.log("OSjs::Core::Process::destroy()",this.__pid,this.__pname);if(D){if(this.__index>=0){A[this.__index]=null}}return true};var r=function(){console.group("OSjs::Core::Main::__construct()");d.apply(this,["Main"]);window.onerror=function(I,F,E,H,G){var J=JSON.stringify({message:I,url:F,linenumber:E,column:H},null,"\t");j(OSjs._("JavaScript Error Report"),OSjs._("An unexpected error occured, maybe a bug."),J,G,true);return false};var D=this;document.addEventListener("keydown",function(E){D._onKeyDown.apply(D,arguments)},false);document.addEventListener("keyup",function(E){D._onKeyUp.apply(D,arguments)},false);document.addEventListener("mousedown",function(E){D._onMouseDown.apply(D,arguments)},false);window.addEventListener("resize",function(E){D._onResize.apply(D,arguments)},false);window.addEventListener("scroll",function(E){D._onScroll.apply(D,arguments)},false);document.addEventListener("mouseout",function(E){D._onLeave(E)},false);document.addEventListener("mouseenter",function(E){D._onEnter(E)},false);this._$root=document.createElement("div");this._$root.id="Background";this._$root.addEventListener("contextmenu",function(E){E.preventDefault();return false},false);this._$root.addEventListener("mousedown",function(E){E.preventDefault();OSjs.GUI.blurMenu()},false);document.body.appendChild(this._$root);console.groupEnd()};r.prototype=Object.create(d.prototype);r.prototype.init=function(){console.log("OSjs::Core::Main::init()");var E=this;var H=function(I){j(OSjs._("Failed to initialize OS.js"),OSjs._("An error occured while initializing OS.js"),I,null,true)};var G=function(J){var I=c.getConfig("WM");if(!I||!I.exec){H(OSjs._("Cannot launch OS.js: No window manager defined!"));return}e(I.exec,I.args||{},function(){J()},function(K){H(OSjs._("Cannot launch OS.js: Failed to launch Window Manager: {0}",K))})};var D=function(I,J){OSjs.Utils.Preload(I,function(K,L){if(L){H(OSjs._("Cannot launch OS.js: Failed to preload resources..."));return}J()})};var F=function(){G(function(I){q.style.display="none";i("service-login");c.loadSession(function(){setTimeout(function(){E._onResize()},u)});c.onInitialized();if(a){a.style.display="none"}})};c.boot(function(I,J){if(J){H(J);return}var K=c.getConfig("Core").Preloads;D(K,function(){setTimeout(function(){F()},0)})})};r.prototype.shutdown=function(H,G){var E=this;var K=null;if(H){var J=function(R){var M=R.__args;var Q=R.__windows;var O={name:R.__name,args:M,windows:[]};var P;for(var N=0,L=Q.length;N<L;N++){P=Q[N];if(!P||!P._properties.allow_session){continue}O.windows.push({name:P._name,dimension:P._dimension,position:P._position,state:P._state})}return O};var I=[];for(var F=0,D=A.length;F<D;F++){if(A[F]&&(A[F] instanceof OSjs.Core.Application)){I.push(J(A[F]))}}K=I}c.logout(K,function(){i("service-logout");G(E)})};r.prototype.destroy=function(){console.log("OSjs::Core::Main::destroy()");d.prototype.destroy.apply(this,[]);OSjs.GUI.blurMenu();var E=this;document.removeEventListener("keydown",function(G){E._onKeyDown.apply(E,arguments)},false);document.removeEventListener("keyup",function(G){E._onKeyUp.apply(E,arguments)},false);document.removeEventListener("mousedown",function(G){E._onMouseDown.apply(E,arguments)},false);window.removeEventListener("resize",function(G){E._onResize.apply(E,arguments)},false);window.removeEventListener("scroll",function(G){E._onScroll.apply(E,arguments)},false);document.removeEventListener("mouseout",function(G){E._onLeave(G)},false);document.removeEventListener("mouseenter",function(G){E._onEnter(G)},false);if(this._$root){this._$root.removeEventListener("contextmenu",function(G){return false},false);this._$root.removeEventListener("mousedown",function(G){OSjs.GUI.blurMenu()},false)}var F=0;var D=A.length;for(F;F<D;F++){if(!A[F]){continue}A[F].destroy(false);A[F]=null}if(this._$root&&this._$root.parentNode){this._$root.parentNode.removeChild(this._$root);this._$root=null}A=[];window.onerror=function(){}};r.prototype.message=function(G,F){for(var E=0,D=A.length;E<D;E++){if(A[E]&&A[E] instanceof C){A[E]._onMessage(null,G,F)}}};r.prototype.kill=function(D){if(D>0){D--;if(A[D]){console.warn("Killing application",D);if(A[D].destroy(true)===false){return}A[D]=null}}};r.prototype.ps=function(){var D=[];var G;for(var F=0,E=A.length;F<E;F++){G=A[F];if(!G){continue}D.push({pid:G.__pid,name:G.__pname,started:G.__started})}return D};r.prototype._onKeyUp=function(D){if(s){s.onKeyUp(D,p)}};r.prototype._onKeyDown=function(D){var F=D.srcElement||D.target;var G=F.tagName==="BODY"?true:false;var E=false;if((F.tagName.toUpperCase()==="INPUT"&&(F.type.toUpperCase()==="TEXT"||F.type.toUpperCase()==="PASSWORD"||F.type.toUpperCase()==="FILE"))||F.tagName.toUpperCase()==="TEXTAREA"){E=F.readOnly||F.disabled}if(D.keyCode===OSjs.Utils.Keys.BACKSPACE){if(E){G=true}}if(G){D.preventDefault()}if(p){p._onKeyEvent(D)}if(s){s.onKeyDown(D,p)}};r.prototype._onScroll=function(D){document.body.scrollTop=0;document.body.scrollLeft=0};r.prototype._onLeave=function(D){var E=D.relatedTarget||D.toElement;if(!E||E.nodeName=="HTML"){f=false}else{f=true}};r.prototype._onEnter=function(D){f=true};r.prototype._onMouseDown=function(D){if(p){p._blur()}};r.prototype._onResize=(function(){var D;var E=function(F){if(!s){return}s.resize(F,z())};return function(G){if(D){clearTimeout(D);D=null}var F=this;D=setTimeout(function(){E.call(F,G)},100)}})();r.prototype.getProcesses=function(){return A};r.prototype.getProcess=function(F,I){var H;var D=I?null:[];for(var G=0,E=A.length;G<E;G++){H=A[G];if(!H){continue}if(H.__pname===F){if(I){D=H;break}D.push(H)}}return D};var B=function(E,G,D,F){console.group("OSjs::Core::WindowManager::__construct()");console.log("Name",E);console.log("Arguments",D);this._windows=[];this._settings={};this._themes=D.themes||[{"default":{title:"Default"}}];this.__name=(E||"WindowManager");this.__path=F.path;this.__iter=F.iter;d.apply(this,[this.__name]);s=(G||this);console.groupEnd();this._$notifications=document.createElement("div");this._$notifications.id="Notifications";document.body.appendChild(this._$notifications)};B.prototype=Object.create(d.prototype);B.prototype.destroy=function(){console.log("OSjs::Core::WindowManager::destroy()");var F=0;var E=this._windows.length;var D;for(F;F<E;F++){if(this._windows[F]!==null){this._windows[F].destroy();this._windows[F]=null}}this._windows=[];s=null;return d.prototype.destroy.apply(this,[])};B.prototype.init=function(){console.log("OSjs::Core::WindowManager::init()")};B.prototype.onKeyDown=function(D,E){};B.prototype.resize=function(E,D){};B.prototype.notification=(function(){var D=0;return function(F){F=F||{};F.icon=F.icon||null;F.title=F.title||null;F.message=F.message||"";F.onClick=F.onClick||function(){};if(typeof F.timeout==="undefined"){F.timeout=5000}console.log("OSjs::Core::WindowManager::notification()",F);var G=document.createElement("div");var E=["Notification"];var L=this;var H=null;var K=function(){if(H){clearTimeout(H);H=null}G.onclick=null;if(G.parentNode){G.parentNode.removeChild(G)}D--;if(D<=0){L._$notifications.style.display="none"}};if(F.icon){var I=document.createElement("img");I.alt="";I.src=OSjs.API.getThemeResource(F.icon,"icon","32x32");E.push("HasIcon");G.appendChild(I)}if(F.title){var J=document.createElement("div");J.className="Title";J.appendChild(document.createTextNode(F.title));E.push("HasTitle");G.appendChild(J)}if(F.message){var M=document.createElement("div");M.className="Message";M.appendChild(document.createTextNode(F.message));E.push("HasMessage");G.appendChild(M)}D++;if(D>0){this._$notifications.style.display="block"}G.className=E.join(" ");G.onclick=function(N){K();F.onClick(N)};this._$notifications.appendChild(G);if(F.timeout){H=setTimeout(function(){K()},F.timeout)}}})();B.prototype.addWindow=function(E,D){if(!(E instanceof h)){console.warn("OSjs::Core::WindowManager::addWindow()","Got",E);throw ("addWindow() expects a 'Window' class")}console.log("OSjs::Core::WindowManager::addWindow()");E.init(this,E._appRef);this._windows.push(E);if(D===true||(E instanceof x)){E._focus()}E._inited();return E};B.prototype.removeWindow=function(E){if(!(E instanceof h)){console.warn("OSjs::Core::WindowManager::removeWindow()","Got",E);throw ("removeWindow() expects a 'Window' class")}console.log("OSjs::Core::WindowManager::removeWindow()");var F=0;var D=this._windows.length;for(F;F<D;F++){if(!this._windows[F]){continue}if(this._windows[F]._wid==E._wid){if(!this._windows[F]){break}this._windows[F]=null;return true}}return false};B.prototype.eventWindow=function(D,E){};B.prototype.showSettings=function(){};B.prototype.applySettings=function(D,E){D=D||{};console.log("OSjs::Core::WindowManager::applySettings","forced?",E);if(E){this._settings=D}else{this._settings=OSjs.Utils.mergeObject(this._settings,D)}if(q){q.src=OSjs.API.getThemeResource("loading_small.gif","base")}return true};B.prototype.setSetting=function(E,D){if(D!==null){if(typeof this._settings[E]!=="undefined"){if((typeof this._settings[E]==="object")&&!(this._settings[E] instanceof Array)){if(typeof D==="object"){for(var F in D){if(this._settings[E].hasOwnProperty(F)){if(D[F]!==null){this._settings[E][F]=D[F]}}}return true}}else{this._settings[E]=D;return true}}}return false};B.prototype.getWindowSpace=function(){return z()};B.prototype.getWindowPosition=(function(){var E=0;var D=0;return function(){if(D>=(window.innerHeight-100)){D=0}if(E>=(window.innerWidth-100)){E=0}return{x:E+=10,y:D+=10}}})();B.prototype.getSetting=function(D){if(typeof this._settings[D]!=="undefined"){return this._settings[D]}return null};B.prototype.getSettings=function(){return this._settings};B.prototype.getThemes=function(){return this._themes};B.prototype.getWindows=function(){return this._windows};var t=function(E,D){this.__name=E;this.__args=D;d.apply(this,[E])};t.prototype=Object.create(d.prototype);t.prototype.init=function(){};t.prototype._call=function(G,D,F,E){F=F||function(){};E=E||function(){};return v("application",{application:this.__name,method:G,"arguments":D},F,E)};var C=function(E,D,F,G){console.group("OSjs::Core::Application::__construct()");this.__name=E;this.__label=F.name;this.__path=F.path;this.__iter=F.iter;this.__destroyed=false;this.__running=true;this.__inited=false;this.__windows=[];this.__args=D||{};this.__settings=G||{};this.__metadata=F;d.apply(this,[E]);console.log("Name",this.__name);console.log("Args",this.__args);console.groupEnd()};C.prototype=Object.create(d.prototype);C.prototype.init=function(E,G){console.log("OSjs::Core::Application::init()",this.__name);if(G){this.__settings=OSjs.Utils.mergeObject(this.__settings,G)}if(this.__windows.length){if(s){var H=null;var F=0,D=this.__windows.length;for(F;F<D;F++){if(this.__windows[F]){s.addWindow(this.__windows[F]);H=this.__windows[F]}}if(H){H._focus()}}}this.__inited=true};C.prototype.destroy=function(E){if(this.__destroyed){return true}this.__destroyed=true;console.log("OSjs::Core::Application::destroy()",this.__name);var D;while(this.__windows.length){D=this.__windows.pop();if(D){D.destroy()}}return d.prototype.destroy.apply(this,arguments)};C.prototype._onMessage=function(E,F,D){if(!F){return}if(F==="destroyWindow"){this._removeWindow(E)}else{if(F==="attention"){if(this.__windows.length){if(this.__windows[0]){this.__windows[0]._focus()}}}}};C.prototype._call=function(H,E,G,F){var D=this;G=G||function(){};F=F||function(I){I=I||"Unknown error";OSjs.API.error(OSjs._("Application API error"),OSjs._("Application {0} failed to perform operation '{1}'",D.__name,H),I)};return v("application",{application:this.__iter,path:this.__path,method:H,"arguments":E},G,F)};C.prototype._createDialog=function(F,E,G){if(OSjs.Dialogs[F]){var D=Object.create(OSjs.Dialogs[F].prototype);OSjs.Dialogs[F].apply(D,E);if(G&&(G instanceof h)){G._addChild(D)}this._addWindow(D);return D}return false};C.prototype._addWindow=function(D){if(!(D instanceof h)){throw"Application::_addWindow() expects Window"}console.info("OSjs::Core::Application::_addWindow()");this.__windows.push(D);if(this.__inited){if(s){s.addWindow(D)}setTimeout(function(){D._focus()},5)}return D};C.prototype._removeWindow=function(E){if(!(E instanceof h)){throw"Application::_removeWindow() expects Window"}var F=0;var D=this.__windows.length;for(F;F<D;F++){if(this.__windows[F]){if(this.__windows[F]._wid===E._wid){console.info("OSjs::Core::Application::_removeWindow()",E._wid);this.__windows[F].destroy();this.__windows.splice(F,1);break}}}};C.prototype._getWindow=function(H,G){G=G||"name";var F=0;var E=this.__windows.length;var D=G==="tag"?[]:null;for(F;F<E;F++){if(this.__windows[F]){if(this.__windows[F]["_"+G]===H){if(G==="tag"){D.push(this.__windows[F])}else{D=this.__windows[F];break}}}}return D};C.prototype._getWindowByName=function(D){return this._getWindow(D)};C.prototype._getWindowsByTag=function(D){return this._getWindow(D,"tag")};C.prototype._getWindows=function(){return this.__windows};C.prototype._getSetting=function(D){return this.__settings[D]};C.prototype._setSetting=function(E,D,F,G){F=(typeof F==="undefined"||F===true);this.__settings[E]=D;if(F&&c){c.setApplicationSettings(this.__name,this.__settings,G)}};C.prototype._getArgument=function(D){return typeof this.__args[D]==="undefined"?null:this.__args[D]};C.prototype._setArgument=function(E,D){this.__args[E]=D};var h=(function(){var H=0;var E=200;var D=200;var I=100;var G=100;var J=1;var F=[];return function(M,O,L){if(OSjs.Utils.inArray(F,M)){throw OSjs.Utils.format("You already have a Window named '{0}'",M)}var N=OSjs.API.getThemeResource("wm.png","wm");var K={x:(O.x),y:(O.y)};var P={w:(O.width||E),h:(O.height||D)};this._$element=null;this._$root=null;this._$winicon=null;this._$loading=null;this._$disabled=null;this._rendered=false;this._appRef=L||null;this._destroyed=false;this._wid=H;this._icon=N;this._name=M;this._title=M;this._tag=O.tag||M;this._position=K;this._dimension=P;this._lastDimension=this._dimension;this._lastPosition=this._position;this._tmpPosition=null;this._children=[];this._parent=null;this._guiElements=[];this._guiElement=null;this._disabled=true;this._sound=null;this._soundVolume=J;this._blinkTimer=null;this._properties={gravity:null,allow_move:true,allow_resize:true,allow_minimize:true,allow_maximize:true,allow_close:true,allow_windowlist:true,allow_drop:false,allow_iconmenu:true,allow_ontop:true,allow_hotkeys:true,allow_session:true,min_width:O.min_height||I,min_height:O.min_width||G,max_width:O.max_width||null,max_height:O.max_height||null};this._state={focused:false,modal:false,minimized:false,maximized:false,ontop:false,onbottom:false};this._hooks={focus:[],blur:[],destroy:[],maximize:[],minimize:[],restore:[],resize:[],resized:[]};console.info("OSjs::Core::Window::__construct()",this._wid,this._name);H++}})();h.prototype.init=function(ab){var W=this;var Q=OSjs.Utils.getCompability().touch;console.group("OSjs::Core::Window::init()");this._state.focused=false;this._icon=OSjs.API.getIcon(this._icon,this._appRef);if(!this._properties.gravity){if((typeof this._position.x==="undefined")||(typeof this._position.y==="undefined")){var D=s?s.getWindowPosition():{x:0,y:0};this._position.x=D.x;this._position.y=D.y}}if(this._properties.min_height){if(this._dimension.h<this._properties.min_height){this._dimension.h=this._properties.min_height}}if(this._properties.max_width){if(this._dimension.w<this._properties.max_width){this._dimension.w=this._properties.max_width}}if(this._properties.max_height){if(this._dimension.h>this._properties.max_height){this._dimension.h=this._properties.max_height}}if(this._properties.max_width){if(this._dimension.w>this._properties.max_width){this._dimension.w=this._properties.max_width}}var ai=this._properties.gravity;if(ai){if(ai==="center"){this._position.y=(window.innerHeight/2)-(this._dimension.h/2);this._position.x=(window.innerWidth/2)-(this._dimension.w/2)}else{var af=g();if(ai.match(/^south/)){this._position.y=af.height-this._dimension.h}else{this._position.y=af.top}if(ai.match(/west$/)){this._position.x=af.left}else{this._position.x=af.width-this._dimension.w}}}console.log("Properties",this._properties);console.log("Position",this._position);console.log("Dimension",this._dimension);var I=document.createElement("div");this._addEvent(I,"oncontextmenu",function(al){OSjs.GUI.blurMenu();if(al.target&&(al.target.tagName==="TEXTAREA"||al.target.tagName==="INPUT")){return true}return false});if(this._properties.allow_drop){if(OSjs.Compability.dnd){var Z=document.createElement("div");Z.className="WindowDropRect";var N=function(){if(!Z.parentNode){document.body.appendChild(Z)}Z.style.top=(I.offsetTop+2)+"px";Z.style.left=(I.offsetLeft+2)+"px";Z.style.width=(I.offsetWidth-4)+"px";Z.style.height=(I.offsetHeight-4)+"px";Z.style.zIndex=I.style.zIndex-1;Z.style.display="block";OSjs.Utils.$addClass(I,"WindowHintDnD")};var aj=function(){Z.style.top=0+"px";Z.style.left=0+"px";Z.style.width=0+"px";Z.style.height=0+"px";Z.style.display="none";if(Z.parentNode){Z.parentNode.removeChild(Z)}OSjs.Utils.$removeClass(I,"WindowHintDnD")};OSjs.GUI.createDroppable(I,{onOver:function(an,am,al){N()},onLeave:function(){aj()},onDrop:function(){aj()},onItemDropped:function(ao,am,an,al){aj();return W._onDndEvent(ao,"itemDrop",an,al)},onFilesDropped:function(ao,am,an,al){aj();return W._onDndEvent(ao,"filesDrop",an,al)}})}}var ag=document.createElement("div");ag.className="WindowTop";var ae=document.createElement("div");ae.className="WindowIcon";var E=document.createElement("img");E.alt=this._title;E.src=this._icon;E.width=16;E.height=16;this._addEvent(ae,"ondblclick",function(al){al.preventDefault()});this._addEventListener(ae,(Q?"touchend":"click"),function(al){al.preventDefault();al.stopPropagation();W._onWindowIconClick(al,this)});var H=document.createElement("div");H.className="WindowTitle";H.appendChild(document.createTextNode(this._title));var O=document.createElement("div");O.className="WindowButtons";if(!Q){this._addEvent(O,"onmousedown",function(al){al.preventDefault();return n(al)})}var ak=document.createElement("div");ak.className="WindowButton WindowButtonMinimize";ak.innerHTML="&nbsp;";if(this._properties.allow_minimize){this._addEventListener(ak,(Q?"touchend":"click"),function(al){al.preventDefault();al.stopPropagation();W._onWindowButtonClick(al,this,"minimize");return false})}else{ak.style.display="none"}var G=document.createElement("div");G.className="WindowButton WindowButtonMaximize";G.innerHTML="&nbsp;";if(this._properties.allow_maximize){this._addEventListener(G,(Q?"touchend":"click"),function(al){al.preventDefault();al.stopPropagation();W._onWindowButtonClick(al,this,"maximize");return false})}else{G.style.display="none"}var Y=document.createElement("div");Y.className="WindowButton WindowButtonClose";Y.innerHTML="&nbsp;";if(this._properties.allow_close){this._addEventListener(Y,(Q?"touchend":"click"),function(al){al.preventDefault();al.stopPropagation();W._onWindowButtonClick(al,this,"close");return false})}else{Y.style.display="none"}var K=document.createElement("div");K.className="WindowWrapper";var ac=document.createElement("div");ac.className="WindowResize";if(!this._properties.allow_resize){ac.style.display="none"}var ad=document.createElement("div");ad.className="WindowLoading";this._addEvent(ad,"onclick",function(al){al.preventDefault();return false});var X=document.createElement("div");X.className="WindowLoadingIndicator";var P=document.createElement("div");P.className="WindowDisabledOverlay";this._addEvent(P,(Q?"touchstart":"onmousedown"),function(al){al.preventDefault();return false});var ah=["Window"];ah.push("Window_"+OSjs.Utils.$safeName(this._name));if(this._tag&&(this._name!=this._tag)){ah.push(OSjs.Utils.$safeName(this._tag))}I.className=ah.join(" ");I.style.width=this._dimension.w+"px";I.style.height=this._dimension.h+"px";I.style.top=this._position.y+"px";I.style.left=this._position.x+"px";I.style.zIndex=b(this._state.ontop);ae.appendChild(E);O.appendChild(ak);O.appendChild(G);O.appendChild(Y);ag.appendChild(ae);ag.appendChild(H);ag.appendChild(O);ad.appendChild(X);I.appendChild(ag);I.appendChild(K);I.appendChild(ac);I.appendChild(ad);I.appendChild(P);var V=0;var U=0;var T=0;var S=0;var aa=null;var J=false;var M=null;var L=function(am,al){am.preventDefault();if(W._state.maximized){return false}M=s.getWindowSpace();if(al==="move"){T=W._position.x;S=W._position.y;OSjs.Utils.$addClass(I,"WindowHintMoving")}else{T=W._dimension.w;S=W._dimension.h;OSjs.Utils.$addClass(I,"WindowHintResizing")}V=Q?(am.changedTouches[0]||{}).clientX:am.clientX;U=Q?(am.changedTouches[0]||{}).clientY:am.clientY;aa=al;document.addEventListener((Q?"touchmove":"mousemove"),R,false);document.addEventListener((Q?"touchend":"mouseup"),F,false);return false};var F=function(al){if(J){if(s){if(aa==="move"){W._onChange("move")}else{if(aa==="resize"){W._onChange("resize");W._fireHook("resized")}}}}OSjs.Utils.$removeClass(I,"WindowHintMoving");OSjs.Utils.$removeClass(I,"WindowHintResizing");document.removeEventListener((Q?"touchmove":"mousemove"),R,false);document.removeEventListener((Q?"touchend":"mouseup"),F,false);aa=null;V=0;U=0;J=false;M=null};var R=function(ao){if(!f){return}if(aa===null){return}var al=Q?(ao.changedTouches[0]||{}).clientX:ao.clientX;var ar=Q?(ao.changedTouches[0]||{}).clientY:ao.clientY;var an=al-V;var am=ar-U;var aq=T+an;var ap=S+am;if(aa==="move"){if(ap<M.top){ap=M.top}W._move(aq,ap)}else{W._resize(aq,ap);W._fireHook("resize")}J=true};if(this._properties.allow_move){this._addEventListener(ag,(Q?"touchstart":"mousedown"),function(al){L(al,"move")})}if(this._properties.allow_resize){this._addEventListener(ac,(Q?"touchstart":"mousedown"),function(al){L(al,"resize")})}this._addEventListener(I,(Q?"touchstart":"mousedown"),function(al){W._focus();return n(al)});this._$element=I;this._$root=K;this._$loading=ad;this._$winicon=E;this._$disabled=P;document.body.appendChild(this._$element);H.style.right=O.offsetWidth+"px";this._onChange("create");this._toggleLoading(false);this._toggleDisabled(false);if(this._sound){i(this._sound,this._soundVolume)}console.groupEnd();return this._$root};h.prototype._inited=function(){if(!this._rendered){for(var D=0;D<this._guiElements.length;D++){if(this._guiElements[D]){this._guiElements[D].update()}}}this._rendered=true};h.prototype.destroy=function(){var D=this;if(this._destroyed){return}this._destroyed=true;console.log("OSjs::Core::Window::destroy()");this._onChange("close");this._fireHook("destroy");if(this._parent){this._parent._removeChild(this)}this._parent=null;if(this._guiElements&&this._guiElements.length){for(var G=0,E=this._guiElements.length;G<E;G++){if(this._guiElements[G]){this._guiElements[G].destroy();this._guiElements[G]=null}}}this._guiElements=[];this._removeChildren();if(s){s.removeWindow(this)}if(p&&p._wid==this._wid){p=null}if(this._$element){var H=function(){if(D._$element.parentNode){D._$element.parentNode.removeChild(D._$element)}};var F=s?s.getSetting("animations"):false;if(F){OSjs.Utils.$addClass(this._$element,"WindowHintClosing");setTimeout(function(){H()},u)}else{this._$element.style.display="none";H()}}if(this._appRef){this._appRef._onMessage(this,"destroyWindow",{})}this._appRef=null;this._hooks={}};h.prototype._addEvent=function(D,E,F){D[E]=F;this._addHook("destroy",function(){D[E]=null})};h.prototype._addEventListener=function(D,E,F){D.addEventListener(E,F,false);this._addHook("destroy",function(){D.removeEventListener(E,F,false)})};h.prototype._addHook=function(D,E){if(typeof E==="function"&&this._hooks[D]){this._hooks[D].push(E)}};h.prototype._fireHook=function(E,F){F=F||{};if(this._hooks[E]){for(var G=0,D=this._hooks[E].length;G<D;G++){if(!this._hooks[E][G]){continue}try{this._hooks[E][G].apply(this,F)}catch(H){console.warn("Window::_fireHook() failed to run hook",E,G,H)}}}};h.prototype._removeGUIElement=function(D){var E,G;for(var F=0;F<this._guiElements.length;F++){E=this._guiElements[F];G=false;if(E){if(D instanceof OSjs.GUI.GUIElement){if(E.id===D.id){G=F}}else{if(E.id===D||E.name===D){G=F}}}if(G!==false){this._guiElements[G].destroy();this._guiElements[G]=null;break}}};h.prototype._addGUIElement=function(E,D){var F=this;if(!D){throw"Adding a GUI Element requires a parentNode"}if(E instanceof OSjs.GUI.GUIElement){E._setWindow(this);if(E.opts&&E.opts.focusable){E._addHook("focus",function(){F._guiElement=this});this._addHook("blur",function(){E.blur()})}if((E instanceof OSjs.GUI.RichText)){E._addHook("focus",function(){OSjs.GUI.blurMenu();F._focus()});var G=null,H;this._addHook("resize",function(){if(!G){H=OSjs.Utils.$position(E.$element);G=document.createElement("div");G.className="IFrameResizeFixer";G.style.position="absolute";G.style.zIndex=9999999999;G.style.background="transparent";document.body.appendChild(G)}G.style.top=H.top+"px";G.style.left=H.left+"px";G.style.width=(E.$element.offsetWidth||0)+"px";G.style.height=(E.$element.offsetHeight||0)+"px"});this._addHook("resized",function(){if(G&&G.parentNode){G.parentNode.removeChild(G);G=null}})}this._guiElements.push(E);D.appendChild(E.getRoot());if(this._rendered){E.update()}return E}return false};h.prototype._addChild=function(D,E){console.info("OSjs::Core::Window::_addChild()");D._parent=this;if(E&&s){s.addWindow(D)}this._children.push(D)};h.prototype._removeChild=function(E){var F=0,D=this._children.length;for(F;F<D;F++){if(this._children[F]&&this._children[F]._wid===E._wid){console.info("OSjs::Core::Window::_removeChild()");this._children[F].destroy();this._children[F]=null;break}}};h.prototype._getChild=function(H,G){G=G||"wid";var D=G==="tag"?[]:null;var F=0,E=this._children.length;for(F;F<E;F++){if(this._children[F]){if(G==="tag"){D.push(this._children[F])}else{if(this._children[F]["_"+G]===H){D=this._children[F];break}}}}return D};h.prototype._getChildById=function(D){return this._getChild(D,"wid")};h.prototype._getChildByName=function(D){return this._getChild(D,"name")};h.prototype._getChildrenByTag=function(D){return this._getChild(D,"tag")};h.prototype._getChildren=function(){return this._children};h.prototype._removeChildren=function(){if(this._children&&this._children.length){var E=0,D=this._children.length;for(E;E<D;E++){if(this._children[E]){this._children[E].destroy()}}}this._children=[]};h.prototype._close=function(){console.info("OSjs::Core::Window::_close()");if(this._disabled){return}OSjs.Utils.$addClass(this._$element,"WindowHintClosing");this._blur();this.destroy()};h.prototype._minimize=function(){var D=this;console.debug(this._name,">","OSjs::Core::Window::_minimize()");if(!this._properties.allow_minimize){return false}if(this._state.minimized){this._restore(false,true);return true}this._blur();this._state.minimized=true;OSjs.Utils.$addClass(this._$element,"WindowHintMinimized");var F=function(){D._$element.style.display="none"};var E=s?s.getSetting("animations"):false;if(E){setTimeout(function(){F()},u)}else{F()}this._onChange("minimize");this._fireHook("minimize");if(p&&p._wid==this._wid){p=null}return true};h.prototype._maximize=function(){console.debug(this._name,">","OSjs::Core::Window::_maximize()");if(!this._properties.allow_maximize){return false}if(this._state.maximized){this._restore(true,false);return true}this._lastPosition={x:this._position.x,y:this._position.y};this._lastDimension={w:this._dimension.w,h:this._dimension.h};this._state.maximized=true;var E=g();this._$element.style.zIndex=b(this._state.ontop);this._$element.style.top=E.top+"px";this._$element.style.left=E.left+"px";this._$element.style.width=E.width+"px";this._$element.style.height=E.height+"px";OSjs.Utils.$addClass(this._$element,"WindowHintMaximized");this._dimension.w=E.width;this._dimension.h=E.height;this._position.x=E.left;this._position.y=E.top;this._onChange("maximize");this._focus();var F=s?s.getSetting("animations"):false;if(F){var D=this;setTimeout(function(){D._fireHook("maximize")},u)}else{this._fireHook("maximize")}return true};h.prototype._restore=function(D,F){if(!this._$element){return}console.debug(this._name,">","OSjs::Core::Window::_restore()");D=(typeof D==="undefined")?true:(D===true);F=(typeof F==="undefined")?true:(F===true);var H=this._$element.className;if(D&&this._state.maximized){this._move(this._lastPosition.x,this._lastPosition.y);this._resize(this._lastDimension.w,this._lastDimension.h);this._state.maximized=false;OSjs.Utils.$removeClass(this._$element,"WindowHintMaximized")}if(F&&this._state.minimized){this._$element.style.display="block";this._state.minimized=false;OSjs.Utils.$removeClass(this._$element,"WindowHintMinimized")}this._onChange("restore");var G=s?s.getSetting("animations"):false;if(G){var E=this;setTimeout(function(){E._fireHook("restore")},u)}else{this._fireHook("restore")}this._focus()};h.prototype._focus=function(D){this._toggleAttentionBlink(false);this._$element.style.zIndex=b(this._state.ontop);OSjs.Utils.$addClass(this._$element,"WindowHintFocused");if(p&&p._wid!=this._wid){p._blur()}p=this;if(!this._state.focused||D){this._onChange("focus");this._fireHook("focus")}this._state.focused=true;return true};h.prototype._blur=function(D){if(!D&&!this._state.focused){return false}OSjs.Utils.$removeClass(this._$element,"WindowHintFocused");this._state.focused=false;this._onChange("blur");this._fireHook("blur");if(p&&p._wid==this._wid){p=null}return true};h.prototype._resizeTo=function(N,Q,M,S){if(N<=0||Q<=0){return}S=(typeof S==="undefined"||S===true);var V=OSjs.Utils.$position(M);var T=OSjs.Utils.$position(this._$root);if(V===null||T===null){throw"Window resize failed, missing measure of element."}var H=V.left-T.left;var F=V.top-T.top;var R=T.right-V.right;var P=T.bottom-V.bottom;var G=this._$element.offsetWidth;var O=this._$element.offsetHeight;var L=(G-this._$root.offsetWidth);var K=(O-this._$root.offsetHeight);var U=N+L+H+R;var E=Q+K+F+P;if(S){var D=z();var J=this._position.x;var I=this._position.y;if((U+J)>D.width){U=(D.width-J-10)}if((E+I)>D.height){E=(D.height-I-10)}}this._resize(U,E)};h.prototype._resize=function(D,E,F){if(!F){if(!this._properties.allow_resize){return false}if(D<this._properties.min_width){D=this._properties.min_width}if(this._properties.max_width!==null){if(D>this._properties.max_width){D=this._properties.max_width}}if(E<this._properties.min_height){E=this._properties.min_height}if(this._properties.max_height!==null){if(E>this._properties.max_height){E=this._properties.max_height}}}if(D){this._$element.style.width=D+"px";this._dimension.w=D}if(E){this._$element.style.height=E+"px";this._dimension.h=E}return true};h.prototype._moveTo=function(G){if(!s){return}var E=s.getWindowSpace();var D=this._position.x;var F=this._position.y;if(G=="left"){this._move(E.left,F)}else{if(G=="right"){this._move((E.width-this._dimension.w),F)}else{if(G=="top"){this._move(D,E.top)}else{if(G=="bottom"){this._move(D,(E.height-this._dimension.h))}}}}};h.prototype._move=function(D,E){if(!this._properties.allow_move){return false}if(typeof D==="undefined"||typeof E==="undefined"){return}this._$element.style.top=E+"px";this._$element.style.left=D+"px";this._position.x=D;this._position.y=E;return true};h.prototype._error=function(I,H,G,E,F){console.debug(this._name,">","OSjs::Core::Window::_error()");var D=j(I,H,G,E,F);this._addChild(D)};h.prototype._toggleDisabled=function(D){console.debug(this._name,">","OSjs::Core::Window::_toggleDisabled()",D);this._$disabled.style.display=D?"block":"none";this._disabled=D?true:false};h.prototype._toggleLoading=function(D){console.debug(this._name,">","OSjs::Core::Window::_toggleLoading()",D);this._$loading.style.display=D?"block":"none"};h.prototype._toggleAttentionBlink=function(E){if(this._state.focused){return false}var G=false;var F=this._$element;var D=this;var H=function(I){if(F){if(I){OSjs.Utils.$addClass(F,"WindowAttentionBlink")}else{OSjs.Utils.$removeClass(F,"WindowAttentionBlink")}}D._onChange(I?"attention_on":"attention_off")};H(E);return true};h.prototype._onDndEvent=function(E,D){console.info("OSjs::Core::Window::_onDndEvent()",D);if(this._disabled){return false}return true};h.prototype._onKeyEvent=function(D){if(this._guiElement){if(D.type=="keydown"&&!this._guiElement.hasCustomKeys){this._guiElement.onKeyPress(D)}}};h.prototype._onWindowIconClick=function(F,E){console.debug(this._name,">","OSjs::Core::Window::_onWindowIconClick()");if(!this._properties.allow_iconmenu){return}var D=this;var G=[];if(this._properties.allow_minimize){G.push({title:OSjs._("Minimize"),icon:"actions/stock_up.png",onClick:function(I,H){D._minimize()}})}if(this._properties.allow_maximize){G.push({title:OSjs._("Maximize"),icon:"actions/window_fullscreen.png",onClick:function(I,H){D._maximize();D._focus()}})}if(this._state.maximized){G.push({title:OSjs._("Restore"),icon:"actions/view-restore.png",onClick:function(I,H){D._restore();D._focus()}})}if(this._properties.allow_ontop){if(this._state.ontop){G.push({title:OSjs._("On Top - Disable"),icon:"actions/window-new.png",onClick:function(I,H){D._state.ontop=false;D._$element.style.zIndex=b(false);D._focus()}})}else{G.push({title:OSjs._("On Top - Enable"),icon:"actions/window-new.png",onClick:function(I,H){D._state.ontop=true;D._$element.style.zIndex=b(true);D._focus()}})}}if(this._properties.allow_close){G.push({title:OSjs._("Close"),icon:"actions/window-close.png",onClick:function(I,H){D._close()}})}OSjs.GUI.createMenu(G,{x:F.clientX,y:F.clientY})};h.prototype._onWindowButtonClick=function(F,E,D){console.debug(this._name,">","OSjs::Core::Window::_onWindowButtonClick()",D);if(D==="close"){this._close()}else{if(D==="minimize"){this._minimize()}else{if(D==="maximize"){this._maximize()}}}};h.prototype._onChange=function(D){D=D||"";if(D){console.debug(this._name,">","OSjs::Core::Window::_onChange()",D);if(s){s.eventWindow(D,this)}}};h.prototype._getViewRect=function(){return this._$element?OSjs.Utils.$position(this._$element):null};h.prototype._getRoot=function(){return this._$root};h.prototype._getGUIElement=function(G){var E;for(var F=0,D=this._guiElements.length;F<D;F++){E=this._guiElements[F];if(E&&(E.id===G||E.name===G)){return E}}return null};h.prototype._setTitle=function(E){if(!this._$element){return}var D=this._$element.getElementsByClassName("WindowTitle")[0];if(D){D.innerHTML="";D.appendChild(document.createTextNode(E))}this._title=E;this._onChange("title")};h.prototype._setIcon=function(D){if(this._$winicon){this._$winicon.src=D}this._icon=D;this._onChange("icon")};var x=function(){h.apply(this,arguments);this._properties.gravity="center";this._properties.allow_resize=false;this._properties.allow_minimize=false;this._properties.allow_maximize=false;this._properties.allow_windowlist=false;this._properties.allow_session=false;this._state.ontop=true};x.prototype=Object.create(h.prototype);OSjs.Core.Process=d;OSjs.Core.Application=C;OSjs.Core.Service=t;OSjs.Core.Window=h;OSjs.Core.DialogWindow=x;OSjs.Core.WindowManager=B;OSjs.API.getHandlerInstance=function(){return c};OSjs.API.getWMInstance=function(){return s};OSjs.API.getCoreInstance=function(){return w};OSjs.API.getDefaultPath=function(D){return(c.getConfig("Core").Home||(D||"/"))};OSjs.API.getThemeCSS=function(D){return c.getThemeCSS(D)};OSjs.API.getResourceURL=function(D){return c.getResourceURL(D)};OSjs.API.getThemeResource=function(E,F,D){return c.getThemeResource(E,F,D)};OSjs.API.getApplicationResource=function(E,D){return c.getApplicationResource(E,D)};OSjs.API.getIcon=function(D,E){return c.getIcon(D,E)};OSjs.API.call=v;OSjs.API.error=j;OSjs.API.launch=e;OSjs.API.launchList=m;OSjs.API.open=o;OSjs.API.playSound=i;var l=false;var y=function(){if(typeof OSjs.Hooks!=="undefined"){if(typeof OSjs.Hooks.onInitialize==="function"){OSjs.Hooks.onInitialize()}}a=document.getElementById("LoadingScreen");k=a?a.getElementsByTagName("p")[0]:null;q=document.createElement("div");q.id="Loading";q.innerHTML='<div class="loader"></div>';document.body.appendChild(q);w=new r();if(w){w.init()}};OSjs._initialize=function(){if(l){return}l=true;console.log("");console.log(" .--.  .--.     _               .---.   ");console.log(": ,. :: .--'   :_;              `--. :  ");console.log(": :: :`. `.    .-. .--.   .-..-.  ,','  ");console.log(": :; : _`, : _ : :`._-.'  : `; :.'.'_   ");console.log("`.__.'`.__.':_;: :`.__.'  `.__.':____;  ");console.log("             .-. :                      ");console.log("             `._.'                      ");console.log("");window.onload=null;OSjs.Compability=OSjs.Utils.getCompability();c=new OSjs.Handlers.Current();c.init(function(){y()})};OSjs._shutdown=function(E,F){if(!l){return}l=false;window.onunload=null;var D=function(){if(w){w.destroy();w=null}if(c){c.destroy();c=null}p=null;s=null;if(q&&q.parentNode){q.parentNode.removeChild(q)}q=null};if(F){D()}else{w.shutdown(E,D)}}})();"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(a,h){window.OSjs=window.OSjs||{};OSjs.Dialogs=OSjs.Dialogs||{};var l=function(q,p,r,o){this.$element=null;this.$message=null;this.buttonConfirm=null;this.buttonCancel=null;this.buttonClose=null;this.className=q;this.args=p||{};this.message=p.message||null;this.onClose=o||function(){};a.apply(this,[q,r]);if(this.args.title){this._title=this.args.title}this._sound="dialog-information";this._soundVolume=0.5};l.prototype=Object.create(a.prototype);l.prototype.destroy=function(){if(this._destroyed){return}this.onClose.apply(this,["destroy"]);a.prototype.destroy.apply(this,arguments)};l.prototype.init=function(){var o=a.prototype.init.apply(this,arguments);var p=this;var q=document.createElement("div");q.className="Buttons";this.$element=document.createElement("div");this.$element.className="StandardDialog "+this.className;if(this.message){this.$message=document.createElement("div");this.$message.className="Message";this.$message.innerHTML=this.message;this.$element.appendChild(this.$message)}var r;if((typeof this.args.buttonClose!=="undefined")&&(this.args.buttonClose===true)){r=(this.args.buttonCloseLabel||OSjs._("Close"));this.buttonClose=this._addGUIElement(new OSjs.GUI.Button("Close",{label:r,onClick:function(s,t){if(!this.isDisabled()){p.onCloseClick(t)}}}),q)}if((typeof this.args.buttonCancel==="undefined")||(this.args.buttonCancel===true)){r=(this.args.buttonCancelLabel||OSjs._("Cancel"));this.buttonCancel=this._addGUIElement(new OSjs.GUI.Button("Cancel",{label:r,onClick:function(s,t){if(!this.isDisabled()){p.onCancelClick(t)}}}),q)}if((typeof this.args.buttonOk==="undefined")||(this.args.buttonOk===true)){r=(this.args.buttonOkLabel||OSjs._("OK"));this.buttonConfirm=this._addGUIElement(new OSjs.GUI.Button("OK",{label:r,onClick:function(s,t){if(!this.isDisabled()){p.onConfirmClick.call(p,t)}}}),q)}this.$element.appendChild(q);o.appendChild(this.$element);return o};l.prototype._inited=function(){a.prototype._inited.apply(this,arguments);if(this.buttonConfirm){this.buttonConfirm.focus()}else{if(this.buttonCancel){this.buttonCancel.focus()}}};l.prototype.onCloseClick=function(o){if(!this.buttonClose){return}this.end("close")};l.prototype.onCancelClick=function(o){if(!this.buttonCancel){return}this.end("cancel")};l.prototype.onConfirmClick=function(o){if(!this.buttonConfirm){return}this.end("ok")};l.prototype._onKeyEvent=function(o){a.prototype._onKeyEvent.apply(this,arguments);if(o.keyCode===OSjs.Utils.Keys.ESC){if(this.args.buttonClose){this.end("close")}else{this.end("cancel")}}};l.prototype.end=function(){this.onClose.apply(this,arguments);this._close()};var m=function(){this.data={title:"No title",message:"No message",error:""};a.apply(this,["ErrorDialog",{width:400,height:290}]);this._icon="status/dialog-error.png";this._sound="dialog-warning";this._soundVolume=1};m.prototype=Object.create(a.prototype);m.prototype.init=function(t){var B=this.data;var A=this;this._title=this.data.title;var z;var x=a.prototype.init.apply(this,arguments);x.className+=" ErrorDialog";var v=document.createElement("div");v.className=OSjs._("Message");v.innerHTML=this.data.message;x.appendChild(v);z=document.createElement("div");z.className="Label";z.innerHTML=OSjs._("Summary");x.appendChild(z);var o=this._addGUIElement(new OSjs.GUI.Textarea("Summary"),x);o.setValue(this.data.error);var r=this.data.exception;if(r){x.className+=" WithTrace";var u="";if(r.stack){u=r.stack}else{u=r.name;u+="\nFilename: "+r.fileName||"<unknown>";u+="\nLine: "+r.lineNumber;u+="\nMessage: "+r.message;if(r.extMessage){u+="\n"+r.extMessage}}B.exceptionDetail=""+u;z=document.createElement("div");z.className="Label";z.innerHTML=OSjs._("Trace");x.appendChild(z);var s=this._addGUIElement(new OSjs.GUI.Textarea("Trace"),x);s.setValue(u)}var w=this._addGUIElement(new OSjs.GUI.Button("OK",{label:OSjs._("Close"),onClick:function(){A._close()}}),x);if(this.data.bugreport){var p=function(C){A._error(A._title,"Bugreport error",C,null,false)};var q=function(){var C=OSjs.API.getWMInstance();if(C){C.addWindow(new e("The error was reported and will be looked into"))}w.onClick()};var y=this._addGUIElement(new OSjs.GUI.Button("Bug",{label:OSjs._("Bugreport"),onClick:function(){OSjs.API.call("bugreport",{data:B},function(C){if(C){if(C.result){q();return}else{if(C.error){p(C.error);return}}}p("Something went wrong during reporting. You can mail it to andersevenrud@gmail.com")},function(C){p(C)})}}),x)}};m.prototype.setError=function(s,r,o,p,q){this.data={title:s,message:r,error:o,exception:p,bugreport:q}};m.prototype._onKeyEvent=function(o){a.prototype._onKeyEvent(this,arguments);if(o.keyCode===OSjs.Utils.Keys.ESC){this._close()}};var f=function(p,r,q,o){this.filename=OSjs.Utils.filename(p);this.mime=r;this.list=q;this.selectedApp=null;this.useDefault=false;var s=([OSjs._("Choose an application to open"),"<br />",OSjs.Utils.format("<span>{0}</span>",this.filename),OSjs.Utils.format("({0})",this.mime)]).join(" ");l.apply(this,["ApplicationChooserDialog",{title:OSjs._("Choose Application"),message:s},{width:400,height:360},o])};f.prototype=Object.create(l.prototype);f.prototype.destroy=function(o){l.prototype.destroy.apply(this,arguments)};f.prototype.onConfirmClick=function(o,r){if(!this.buttonConfirm){return}r=this.selectedApp;if(!r){var p=OSjs.API.getWMInstance();if(p){var q=new e(OSjs._("You need to select an application"));p.addWindow(q);this._addChild(q)}return}this.end("ok",r,this.useDefault)};f.prototype.init=function(A){var B=this;var y=l.prototype.init.apply(this,arguments);var p=this.$element;var t=[];var x=OSjs.API.getHandlerInstance().getApplicationsMetadata();var u=function(D,C){return OSjs.API.getIcon(D,C)};var r,w,o,v;for(var s=0,q=this.list.length;s<q;s++){o=this.list[s];w=null;if(x[this.list[s]]){v=x[this.list[s]];if(v){o=OSjs.Utils.format("{0} - {1}",(v.name||o),(v.description||o));w=u(v.icon,v.path)}}t.push({key:this.list[s],image:w,name:o})}var z=this._addGUIElement(new OSjs.GUI.ListView("ApplicationChooserDialogListView"),p);z.setColumns([{key:"image",title:"",type:"image",domProperties:{width:"16"}},{key:"name",title:OSjs._("Name")},{key:"key",title:"Key",visible:false}]);z.onActivate=function(E,C,D){if(D&&D.key){B.selectedApp=D.key;B.buttonConfirm.setDisabled(false);B.end("ok",D.key,B.useDefault)}};z.onSelect=function(E,C,D){if(D&&D.key){B.selectedApp=D.key;B.buttonConfirm.setDisabled(false)}};this.buttonConfirm.setDisabled(true);z.setRows(t);z.render();this._addGUIElement(new OSjs.GUI.Checkbox("ApplicationChooserDefault",{label:OSjs._("Use as default application for {0}",this.mime),value:this.useDefault,onChange:function(C,D,E){B.useDefault=E?true:false}}),p);return y};var b=function(o){a.apply(this,["FileProgressDialog",{width:400,height:120}]);this.$desc=null;this._title=o||OSjs._("File Operation Progress");this._properties.allow_close=false;this._icon="actions/document-send.png"};b.prototype=Object.create(a.prototype);b.prototype.destroy=function(){a.prototype.destroy.apply(this,arguments)};b.prototype.init=function(){a.prototype.init.apply(this,arguments);var p=this;var o=this._$root;var q=document.createElement("div");q.className="FileProgressDialog";var r=document.createElement("div");r.className="Description";r.innerHTML=OSjs._("Loading...");q.appendChild(r);this._addGUIElement(new OSjs.GUI.ProgressBar("FileProgressBar",0),q);o.appendChild(q);this.$desc=r};b.prototype.setDescription=function(o){if(!this.$desc){return}this.$desc.innerHTML=o};b.prototype.setProgress=function(q){var o=this._getGUIElement("FileProgressBar");if(o){o.setPercentage(q)}};var i=function(p,q,o){this.dest=p;this.file=q||null;this.$file=null;this.dialog=null;this._wmref=null;this.uploadName=null;this.uploadSize=null;this.uploadMime=null;var s=OSjs.API.getHandlerInstance().getConfig("Core").MaxUploadSize;var r=OSjs._("Upload file to <span>{0}</span>.<br />Maximum size: {1} bytes",this.dest,s);l.apply(this,["FileUploadDialog",{title:OSjs._("Upload Dialog"),message:r,buttonOk:false},{width:400,height:140},o]);this._icon="actions/filenew.png"};i.prototype=Object.create(l.prototype);i.prototype.init=function(r){var p=this;var o=l.prototype.init.apply(this,arguments);this._wmref=r;var q=document.createElement("input");q.type="file";q.name="upload";q.onchange=function(s){p.onFileSelected(s,q.files[0])};this.$file=q;this.$element.appendChild(q);if(this.file){this.onFileSelected(null,this.file)}};i.prototype.destroy=function(){this._wmref=null;if(this.dialog){this.dialog._close();this.dialog=null}l.prototype.destroy.apply(this,arguments)};i.prototype._close=function(){if(this.buttonCancel&&(this.buttonCancel.isDisabled())){return}l.prototype._close.apply(this,arguments)};i.prototype.end=function(){if(this.dialog){this.dialog._close();this.dialog=null}this.onClose.apply(this,arguments);this._close()};i.prototype.upload=function(q,p){this.$file.disabled="disabled";this.buttonCancel.setDisabled(true);this.dialog=this._wmref.addWindow(new b(OSjs._("Uploading file...")));this.dialog.setDescription(OSjs._("Uploading '{0}' ({1} {2}) to {3}"+q.name,q.type,p,this.dest));this.dialog.setProgress(0);this._addChild(this.dialog);this.uploadName=q.name;this.uploadSize=p;this.uploadMime=q.type;var o=this;OSjs.Utils.AjaxUpload(q,p,this.dest,{progress:function(){o.onUploadProgress.apply(o,arguments)},complete:function(){o.onUploadComplete.apply(o,arguments)},failed:function(){o.onUploadFailed.apply(o,arguments)},canceled:function(){o.onUploadCanceled.apply(o,arguments)}});setTimeout(function(){if(o.dialog){o.dialog._focus()}},100)};i.prototype.onFileSelected=function(p,q){console.info("FileUploadDialog::onFileSelected()",p,q);if(q){var o=0;if(q.size>1024*1024){o=(Math.round(q.size*100/(1024*1024))/100).toString()+"MB"}else{o=(Math.round(q.size*100/1024)/100).toString()+"KB"}this.upload(q,o)}};i.prototype.onUploadProgress=function(o){if(o.lengthComputable){var q=Math.round(o.loaded*100/o.total);if(this.dialog){this.dialog.setProgress(q)}}};i.prototype.onUploadComplete=function(o){console.info("FileUploadDialog::onUploadComplete()");this.buttonCancel.setDisabled(false);this.end("complete",this.uploadName,this.uploadMime,this.uploadSize)};i.prototype.onUploadFailed=function(o,p){console.info("FileUploadDialog::onUploadFailed()");if(p){this._error(OSjs._("Upload failed"),OSjs._("The upload has failed"),p)}else{this._error(OSjs._("Upload failed"),OSjs._("The upload has failed"),OSjs._("Reason unknown..."))}this.buttonCancel.setDisabled(false);this.end("fail",p)};i.prototype.onUploadCanceled=function(o){console.info("FileUploadDialog::onUploadCanceled()");this._error(OSjs._("Upload failed"),OSjs._("The upload has failed"),OSjs._("Cancelled by user..."));this.buttonCancel.setDisabled(false);this.end("cancelled",o)};i.prototype._error=function(){OSjs.API.error.apply(this,arguments)};var d=function(q,o){q=q||{};this.currentPath=q.path||OSjs.API.getDefaultPath("/");this.currentFilename=q.filename||"";this.defaultFilename=q.defaultFilename||"";this.type=q.type||"open";this.mime=q.mime||null;this.allowMimes=q.mimes||null;this.select=q.select||"file";this.input=null;var p=this;var t=0;this.onError=function(v,x,w){if(v){if(!w){if(t<2){var u=p._getGUIElement("FileDialogFileView");if(u){u.chdir(OSjs.API.getDefaultPath("/"))}}else{t=0}t++}p._error(OSjs._("FileDialog Error"),OSjs._("Failed listing directory '{0}' because an error occured",x),v)}};var s=OSjs._(this.type=="save"?"Save":"Open");var r=this.type=="save"?"FileSaveDialog":"FileOpenDialog";l.apply(this,[r,{title:s},{width:600,height:380},o]);if(this.type==="open"){this._icon="actions/gtk-open.png"}else{this._icon="actions/gtk-save-as.png"}};d.prototype=Object.create(l.prototype);d.prototype.destroy=function(){l.prototype.destroy.apply(this,arguments)};d.prototype.init=function(){var q=this;var o=l.prototype.init.apply(this,arguments);var t=this.select==="path"?"dir":null;var r=this._addGUIElement(new OSjs.GUI.FileView("FileDialogFileView",{mimeFilter:this.allowMimes,typeFilter:t}),this.$element);var s=function(x){if(!r){return}var y=r.viewType;var w=[{name:"ListView",title:OSjs._("List View"),disabled:(y.toLowerCase()=="listview"),onClick:function(){if(r){r.setViewType("ListView")}q._focus()}},{name:"IconView",title:OSjs._("Icon View"),disabled:(y.toLowerCase()=="iconview"),onClick:function(){if(r){r.setViewType("IconView")}q._focus()}},{name:"TreeView",title:OSjs._("Tree View"),disabled:(y.toLowerCase()=="treeview"),onClick:function(){if(r){r.setViewType("TreeView")}q._focus()}}];var z=[{name:"ListView",title:OSjs._("View type"),menu:w}];var A={x:x.clientX,y:x.clientY};OSjs.GUI.createMenu(z,A)};r.onError=function(){q._toggleLoading(false);q.onError.apply(this,arguments)};r.onContextMenu=function(w){s(w)};r.onViewContextMenu=function(w){s(w)};var p=this._addGUIElement(new OSjs.GUI.StatusBar("FileDialogStatusBar"),this.$element);p.setText("");if(this.type==="save"){var v=true;var u=OSjs.Utils.escapeFilename(this.currentFilename?this.currentFilename:this.defaultFilename);this.input=this._addGUIElement(new OSjs.GUI.Text("FileName",{value:u,onKeyPress:function(w){q.buttonConfirm.setDisabled(this.value.length<=0);if(w.keyCode===OSjs.Utils.Keys.ENTER){q.buttonConfirm.onClick(w);return}}}),this.$element);this.input.onKeyPress=function(){q.buttonConfirm.setDisabled(this.getValue().length<=0)};r.onFinished=function(){p.setText(r.getPath());q._toggleLoading(false);if(v){if(q.currentFilename){r.setSelected(q.currentFilename,"filename")}}v=false};r.onRefresh=function(){p.setText(r.getPath());q._toggleLoading(true);if(v){q.input.setValue(u)}else{q.input.setValue("")}};r.onSelected=function(w){if(!w||w.type=="dir"){q.input.setValue("")}else{q.input.setValue(w.filename)}}}else{if(this.select==="file"){this.buttonConfirm.setDisabled(true)}r.onSelected=function(w){if(w){if(this.select==="path"){if(w.type=="dir"||(this.select==="file"&&w.type!="dir"&&w.filename!=="..")){q.buttonConfirm.setDisabled(false)}}else{if(w.type==="file"){q.buttonConfirm.setDisabled(false)}}}};r.onFinished=function(){p.setText(r.getPath());q._toggleLoading(false)};r.onRefresh=function(){p.setText(r.getPath());q._toggleLoading(true);if(q.select==="file"){q.buttonConfirm.setDisabled(true)}}}r.onActivated=function(A,x,z){if(q.select==="file"&&x==="file"){q.buttonConfirm.setDisabled(false);if(q.type==="save"){var y=OSjs.API.getWMInstance();if(y){q._toggleDisabled(true);var w=new n(OSjs._("Are you sure you want to overwrite the file '{0}'?",OSjs.Utils.filename(A)),function(B){q._toggleDisabled(false);if(B=="ok"){q.dialogOK.call(q,A,z)}});y.addWindow(w);q._addChild(w)}}else{q.dialogOK.call(q,A,z)}}else{if(q.select==="path"&&x==="dir"&&OSjs.Utils.filename(A)!=".."){q.buttonConfirm.setDisabled(false)}}};return o};d.prototype._inited=function(){l.prototype._inited.apply(this,arguments);var o=this._getGUIElement("FileDialogFileView");if(o){o.chdir(this.currentPath)}};d.prototype.onConfirmClick=function(o){if(!this.buttonConfirm){return}this.dialogOK()};d.prototype.dialogOK=function(r,t){var q=function(C,B){if(C){this.end("ok",C,B)}else{var A=OSjs.API.getWMInstance();if(A){var z;if(this.type==="save"){z=new e(OSjs._("You need to select a file or enter new filename!"))}else{z=new e(OSjs._("You need to select a file!"))}A.addWindow(z);this._addChild(z)}}};var y,x,o=null;if(r){y=r;o=t}else{var v=this._getGUIElement("FileDialogFileView");if(this.type=="save"){var p=this.input?p=OSjs.Utils.escapeFilename(this.input.getValue()):"";if(p){x=v.viewRef.getItemByKey("filename",p);if(x!==null){var u=OSjs.API.getWMInstance();var w=this;if(u){w._toggleDisabled(true);var s=new n(OSjs._("Are you sure you want to overwrite the file '{0}'?",p),function(z){w._toggleDisabled(false);if(z=="ok"){q.call(w,x.path,x.mime)}});u.addWindow(s);this._addChild(s)}return}}if(!o&&p){o=this.mime}if(!y&&p){y=v.getPath()+"/"+p}}else{if(this.select==="path"){x=v.getSelected();if(x!==null){o=x.mime;y=x.path}else{y=v.getPath();o=null}}else{x=v.getSelected();if(x!==null){o=x.mime;y=x.path}}}}q.call(this,y,o)};d.prototype._focus=function(){l.prototype._focus.apply(this,arguments);if(this.input){this.input.focus();var q=this.input.getValue();var p={min:0,max:q.length-1};if(q.match(/\.(\w+)$/)){var o=q.split(/\.(\w+)$/);if(o){p.max-=(o.length)}}this.input.select(p)}};var k=function(p,o){this.path=p;o=o||function(){};l.apply(this,["FileInformationDialog",{title:OSjs._("File Information"),buttonCancel:false,buttonOkLabel:OSjs._("Close")},{width:300,height:400},o])};k.prototype=Object.create(l.prototype);k.prototype.init=function(){var r=this;var q=l.prototype.init.apply(this,arguments);var t=OSjs._("Loading file information for: {0}",this.path);var p=this._addGUIElement(new OSjs.GUI.Textarea("FileInformationTextarea",{disabled:true,value:t}),this.$element);var s=function(u){var v=OSjs.Utils.filename(r.path);r._error(OSjs._("FileInformationDialog Error"),OSjs._("Failed to get file information for <span>{0}</span>",v),u);p.setValue(OSjs._("Failed to get file information for: {0}",r.path))};var o=function(v){var w=[];for(var u in v){if(v.hasOwnProperty(u)){if(u==="exif"){w.push(u+":\n\n"+v[u])}else{w.push(u+":\n\t"+v[u])}}}p.setValue(w.join("\n\n"))};OSjs.API.call("fs",{method:"fileinfo","arguments":[this.path]},function(u){if(u){if(u.error){s(u.error);return}if(u.result){o(u.result)}}},function(u){s(u)});return q};var e=function(q,o,p){p=OSjs.Utils.mergeObject({title:OSjs._("Alert Dialog"),message:q,buttonCancel:false,buttonOkLabel:OSjs._("Close")},(p||{}));l.apply(this,["AlertDialog",p,{width:250,height:100},o]);this._icon="status/dialog-warning.png"};e.prototype=Object.create(l.prototype);var n=function(q,o,p){p=OSjs.Utils.mergeObject({title:OSjs._("Confirm Dialog"),message:q},(p||{}));l.apply(this,["ConfirmDialog",p,{width:350,height:120},o]);this._icon="status/dialog-question.png"};n.prototype=Object.create(l.prototype);var c=function(q,p,o){l.apply(this,["InputDialog",{title:OSjs._("Input Dialog"),message:q},{width:300,height:150},o]);this._icon="status/dialog-information.png";this.value=p||"";this.input=null};c.prototype=Object.create(l.prototype);c.prototype.init=function(){var p=this;var o=l.prototype.init.apply(this,arguments);var q=document.createElement("div");this.input=this._addGUIElement(new OSjs.GUI.Text("TextInput",{value:this.value,onKeyPress:function(r){if(r.keyCode===OSjs.Utils.Keys.ENTER){p.buttonConfirm.onClick(r);return}}}),q);this.$element.appendChild(q);return o};c.prototype._focus=function(){l.prototype._focus.apply(this,arguments);if(this.input){this.input.focus();this.input.select()}};c.prototype.onConfirmClick=function(o){if(!this.buttonConfirm){return}this.end("ok",this.input.getValue())};var g=function(p,o){p=p||{};if(typeof p.alpha==="undefined"){p.alpha=1}l.apply(this,["ColorDialog",{title:OSjs._("Color Dialog")},{width:450,height:270},o]);this._icon="apps/gnome-settings-theme.png";if(typeof p.color==="object"){this.currentRGB=p.color}else{this.currentRGB=OSjs.Utils.HEXtoRGB(p.color||"#ffffff")}this.showAlpha=p.showAlpha?true:false;this.currentAlpha=p.alpha*100;this.$color=null};g.prototype=Object.create(l.prototype);g.prototype.init=function(){var q=this;var o=l.prototype.init.apply(this,arguments);var p=this.currentRGB;var u=document.createElement("div");u.className="ColorDialog";var t=document.createElement("div");t.className="ColorSliders";var s=document.createElement("div");s.className="Label LabelR";s.innerHTML=OSjs._("Red: {0}",0);t.appendChild(s);this._addGUIElement(new OSjs.GUI.Slider("SliderR",{min:0,max:255,val:p.r,onUpdate:function(w,v){q.setColor(w,q.currentRGB.g,q.currentRGB.b)}}),t);s=document.createElement("div");s.className="Label LabelG";s.innerHTML=OSjs._("Green: {0}",0);t.appendChild(s);this._addGUIElement(new OSjs.GUI.Slider("SliderG",{min:0,max:255,val:p.g,onUpdate:function(w,v){q.setColor(q.currentRGB.r,w,q.currentRGB.b)}}),t);s=document.createElement("div");s.className="Label LabelB";s.innerHTML=OSjs._("Blue: {0}",0);t.appendChild(s);this._addGUIElement(new OSjs.GUI.Slider("SliderB",{min:0,max:255,val:p.b,onUpdate:function(w,v){q.setColor(q.currentRGB.r,q.currentRGB.g,w)}}),t);if(this.showAlpha){s=document.createElement("div");s.className="Label LabelA";s.innerHTML=OSjs._("Alpha: {0}",0);t.appendChild(s);this._addGUIElement(new OSjs.GUI.Slider("SliderA",{min:0,max:100,val:this.currentAlpha,onUpdate:function(w,v){q.setColor(q.currentRGB.r,q.currentRGB.g,q.currentRGB.b,w)}}),t)}this.$color=document.createElement("div");this.$color.className="ColorSelected";this._addGUIElement(new OSjs.GUI.ColorSwatch("ColorDialogColorSwatch",200,200,function(x,w,v){q.setColor(x,w,v)}),this.$element);this.$element.appendChild(t);this.$element.appendChild(this.$color);var r=this.currentRGB;this.setColor(r.r,r.g,r.b,this.currentAlpha)};g.prototype.setColor=function(t,s,o,q){this.currentAlpha=(typeof q==="undefined"?this.currentAlpha:q);this.currentRGB={r:t,g:s,b:o};this.$color.style.background="rgb("+([t,s,o]).join(",")+")";this._getGUIElement("SliderR").setValue(t);this.$element.getElementsByClassName("LabelR")[0].innerHTML=OSjs._("Red: {0}",t);this._getGUIElement("SliderG").setValue(s);this.$element.getElementsByClassName("LabelG")[0].innerHTML=OSjs._("Green: {0}",s);this._getGUIElement("SliderB").setValue(o);this.$element.getElementsByClassName("LabelB")[0].innerHTML=OSjs._("Blue: {0}",o);if(this.showAlpha){var p=(this.currentAlpha/100);this._getGUIElement("SliderA").setValue(this.currentAlpha);this.$element.getElementsByClassName("LabelA")[0].innerHTML=OSjs._("Alpha: {0}",p)}};g.prototype.onCancelClick=function(o){if(!this.buttonCancel){return}this.end("cancel",null,null)};g.prototype.onConfirmClick=function(o){if(!this.buttonConfirm){return}this.end("ok",this.currentRGB,OSjs.Utils.RGBtoHEX(this.currentRGB),(this.currentAlpha/100))};var j=function(p,o){p=p||{};this.fontName=p.name||OSjs.API.getHandlerInstance().getConfig("Fonts")["default"];this.fontSize=p.size||12;this.background=p.background||"#ffffff";this.color=p.color||"#000000";this.fonts=p.list||OSjs.API.getHandlerInstance().getConfig("Fonts").list;this.sizeType=p.sizeType||"px";this.text=p.text||"The quick brown fox jumps over the lazy dog";this.minSize=typeof p.minSize==="undefined"?6:p.minSize;this.maxSize=typeof p.maxSize==="undefined"?30:p.maxSize;this.$selectFonts=null;this.$selectSize=null;l.apply(this,["FontDialog",{title:OSjs._("Font Dialog")},{width:450,height:270},o])};j.prototype=Object.create(l.prototype);j.prototype.updateFont=function(p,q){var o=this._getGUIElement("GUIRichText");if(p!==null&&p){this.fontName=p}if(q!==null&&q){this.fontSize=q<<0}var r=[];if(this.sizeType=="internal"){r=["font-family: "+this.fontName,"background: "+this.background,"color: "+this.color];o.setContent('<font size="'+this.fontSize+'" style="'+r.join(";")+'">'+this.text+"</font>")}else{r=["font-family: "+this.fontName,"font-size: "+this.fontSize+"px","background: "+this.background,"color: "+this.color];o.setContent('<div style="'+r.join(";")+'">'+this.text+"</div>")}};j.prototype.init=function(){var q=this;var p=l.prototype.init.apply(this,arguments);var u;var o=this._addGUIElement(new OSjs.GUI.RichText("GUIRichText"),this.$element);this.$selectFont=document.createElement("select");this.$selectFont.className="SelectFont";this.$selectFont.setAttribute("size","7");for(var v=0;v<this.fonts.length;v++){u=document.createElement("option");u.value=v;u.appendChild(document.createTextNode(this.fonts[v]));this.$selectFont.appendChild(u);if(this.fontName.toLowerCase()==this.fonts[v].toLowerCase()){this.$selectFont.selectedIndex=v}}this._addEvent(this.$selectFont,"onchange",function(w){var s=this.selectedIndex;if(q.fonts[s]){q.updateFont(q.fonts[s],null)}});this.$element.appendChild(this.$selectFont);if(this.maxSize>0){this.$selectSize=document.createElement("select");this.$selectSize.className="SelectSize";this.$selectSize.setAttribute("size","7");var r=0;for(var t=this.minSize;t<=this.maxSize;t++){u=document.createElement("option");u.value=t;u.innerHTML=t;this.$selectSize.appendChild(u);if(this.fontSize==t){this.$selectSize.selectedIndex=r}r++}this._addEvent(this.$selectSize,"onchange",function(w){var s=this.selectedIndex;var x=this.options[s];if(x){q.updateFont(null,x.value)}});this.$element.appendChild(this.$selectSize)}else{this.$element.className+=" NoFontSizes"}return p};j.prototype._inited=function(){l.prototype._inited.apply(this,arguments);this.updateFont()};j.prototype.onConfirmClick=function(o){if(!this.buttonConfirm){return}this.end("ok",this.fontName,this.fontSize)};OSjs.Dialogs._StandardDialog=l;OSjs.Dialogs.File=d;OSjs.Dialogs.FileProgress=b;OSjs.Dialogs.FileUpload=i;OSjs.Dialogs.FileInfo=k;OSjs.Dialogs.ErrorMessage=m;OSjs.Dialogs.Alert=e;OSjs.Dialogs.Confirm=n;OSjs.Dialogs.Input=c;OSjs.Dialogs.Color=g;OSjs.Dialogs.Font=j;OSjs.Dialogs.ApplicationChooser=f})(OSjs.Core.DialogWindow,OSjs.GUI);"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.GUI=OSjs.GUI||{};var m;function I(M,K){K=K||{};K.accept=K.accept||null;K.effect=K.effect||"move";K.mime=K.mime||"application/json";K.files=K.files||true;if(OSjs.Utils.isIE()){K.mime="text"}K.onFilesDropped=K.onFilesDropped||function(){return true};K.onItemDropped=K.onItemDropped||function(){return true};K.onEnter=K.onEnter||function(){return true};K.onOver=K.onOver||function(){return true};K.onLeave=K.onLeave||function(){return true};K.onDrop=K.onDrop||function(){return true};var L=function(R,O){R.stopPropagation();R.preventDefault();K.onDrop.call(this,R,O);if(!R.dataTransfer){return true}if(K.files){var Q=R.dataTransfer.files;if(Q&&Q.length){return K.onFilesDropped.call(this,R,O,Q,K)}}var S;var N=this;try{S=R.dataTransfer.getData(K.mime)}catch(T){console.warn("Failed to drop: "+T)}if(S){var P=JSON.parse(S);if(K.accept===null||K.accept==P.type){return K.onItemDropped.call(N,R,O,P,K)}}return false};M.addEventListener("drop",function(N){return L(N,this)},false);M.addEventListener("dragenter",function(N){return K.onEnter.call(this,N,this,K)},false);M.addEventListener("dragover",function(N){N.preventDefault();N.stopPropagation();N.dataTransfer.dropEffect=K.effect;return K.onOver.call(this,N,this,K)},false);M.addEventListener("dragleave",function(N){return K.onLeave.call(this,N,this,K)},false)}function x(L,K){K=K||{};K.type=K.type||null;K.effect=K.effect||"move";K.data=K.data||null;K.mime=K.mime||"application/json";K.onStart=K.onStart||function(){return true};K.onEnd=K.onEnd||function(){return true};if(OSjs.Utils.isIE()){K.mime="text"}var M=function(N){return JSON.stringify({type:K.type,effect:K.effect,data:K.data,mime:K.mime})};L.setAttribute("draggable","true");L.addEventListener("dragstart",function(N){this.style.opacity="0.4";if(N.dataTransfer){try{N.dataTransfer.effectAllowed=K.effect;N.dataTransfer.setData(K.mime,M(K.mime))}catch(O){console.warn("Failed to dragstart: "+O)}}return K.onStart(N,this,K)},false);L.addEventListener("dragend",function(N){this.style.opacity="1.0";return K.onEnd(N,this,K)},false)}function j(K,O,N,M,L){if(!K){throw"Filename is required for getFileIcon()"}N=N||"file";M=M||"mimetypes/gnome-fs-regular.png";L=L||"16x16";if(N=="dir"){M="places/folder.png"}else{if(N=="file"){if(O){if(O.match(/^application\/(x\-python|javascript)/)||O.match(/^text\/(html|xml|css)/)){M="mimetypes/stock_script.png"}else{if(O.match(/^text\//)){M="mimetypes/txt.png"}else{if(O.match(/^audio\//)){M="mimetypes/sound.png"}else{if(O.match(/^video\//)){M="mimetypes/video.png"}else{if(O.match(/^image\//)){M="mimetypes/image.png"}else{if(O.match(/^application\//)){M="mimetypes/binary.png"}else{if(O.match(/^osjs\/document/)){M="mimetypes/gnome-mime-application-msword.png"}}}}}}}}}}return OSjs.API.getThemeResource(M,"icon",L)}var H=(function(){var K=0;return function(L,M){M=M||{};this.name=L||("Unknown_"+K);this.opts=M||{};this.id=K;this.destroyed=false;this.focused=false;this.wid=0;this.hasChanged=false;this.hasCustomKeys=M.hasCustomKeys===true;this.onItemDropped=M.onItemDropped||function(){};this.onFilesDropped=M.onFilesDropped||function(){};this._onFocusWindow=function(){};this.$element=null;this.inited=false;this._window=null;this._hooks={focus:[],blur:[],destroy:[]};if(typeof this.opts.dnd==="undefined"){this.opts.dnd=false}if(typeof this.opts.dndDrop==="undefined"){this.opts.dndDrop=this.opts.dnd}if(typeof this.opts.dndDrag==="undefined"){this.opts.dndDrag=this.opts.dnd}if(typeof this.opts.dndOpts==="undefined"){this.opts.dndOpts={}}if(typeof this.opts.focusable==="undefined"){this.opts.focusable=true}this.init();K++}})();H.prototype.init=function(M,L){L=L||"div";var K=this;var O=["GUIElement","GUIElement_"+this.id,OSjs.Utils.$safeName(M),OSjs.Utils.$safeName(this.name)];this.$element=document.createElement(L);this.$element.className=O.join(" ");if(this.opts.dnd&&this.opts.dndDrop&&OSjs.Compability.dnd){var N=this.opts.dndOpts;N.onItemDropped=function(R,P,Q){return K.onItemDropped.call(K,R,P,Q)};N.onFilesDropped=function(R,P,Q){return K.onFilesDropped.call(K,R,P,Q)};I(this.$element,N)}if(this.opts.focusable){this._addEventListener(this.$element,"mousedown",function(P){K._onFocus(P)})}return this.$element};H.prototype.update=function(){this.inited=true};H.prototype.destroy=function(){if(this.destroyed){return}this.destroyed=true;this._fireHook("destroy");if(this.$element&&this.$element.parentNode){this.$element.parentNode.removeChild(this.$element)}this._hooks={}};H.prototype._addEvent=function(K,L,M){K[L]=M;this._addHook("destroy",function(){K[L]=null})};H.prototype._addEventListener=function(K,L,M){K.addEventListener(L,M,false);this._addHook("destroy",function(){K.removeEventListener(L,M,false)})};H.prototype._addHook=function(K,L){if(typeof L==="function"&&this._hooks[K]){this._hooks[K].push(L)}};H.prototype._fireHook=function(L,M){M=M||{};if(this._hooks[L]){for(var N=0,K=this._hooks[L].length;N<K;N++){if(!this._hooks[L][N]){continue}try{this._hooks[L][N].apply(this,M)}catch(O){console.warn("GUIElement::_fireHook() failed to run hook",L,N,O)}}}};H.prototype.getRoot=function(){return this.$element};H.prototype.onDndDrop=function(K){return true};H.prototype.onKeyPress=function(K){if(this.hasCustomKeys){return false}if(!this.focused){return false}return true};H.prototype._onFocus=function(K){K.stopPropagation();OSjs.GUI.blurMenu();this.focus();this._onFocusWindow.call(this,K)};H.prototype.focus=function(){if(!this.opts.focusable){return false}if(this.focused){return false}if(m&&m.id!=this.id){m.blur()}console.debug("GUIElement::focus()",this.id,this.name);this.focused=true;this._fireHook("focus");m=this;return true};H.prototype.blur=function(){if(!this.opts.focusable){return false}if(!this.focused){return false}console.debug("GUIElement::blur()",this.id,this.name);this.focused=false;this._fireHook("blur");return true};H.prototype._setWindow=function(K){this.wid=K._wid;this._window=K;this._onFocusWindow=function(){K._focus()}};var G=function(M,L,K,N){N=N||{};N.hasCustomKeys=true;this.$input=null;this.type=L==="input"?(N.type||"text"):null;this.disabled=N.disabled||false;this.value=N.value||"";this.label=N.label||"";this.placeholder=N.placeholder||"";this.className=M;this.tagName=L;this.onChange=N.onChange||function(){};this.onClick=N.onClick||function(){};this.onKeyPress=N.onKeyPress||function(){};H.apply(this,[K,N])};G.prototype=Object.create(H.prototype);G.prototype.init=function(){var L=this;var M=H.prototype.init.apply(this,[this.className]);this.$input=document.createElement(this.tagName);if(this.tagName=="input"){this.$input.type=this.type;if(this.type==="text"||this.type==="password"){if(this.placeholder){this.$input.setAttribute("placeholder",this.placeholder)}this._addEventListener(this.$input,"keypress",function(N){L.onKeyPress.apply(L,[N])})}}if(this.tagName=="button"){if(this.opts.icon){var K=document.createElement("img");K.alt="";K.src=this.opts.icon;this.$input.appendChild(K)}this.$input.appendChild(document.createTextNode(this.value||this.label));this._addEvent(this.$input,"onclick",function(N){if(L.isDisabled()){return}L.onClick.apply(L,[this,N])})}else{this._addEvent(this.$input,"onchange",function(N){L.onChange.apply(L,[this,N,L.getValue()])})}M.appendChild(this.$input);this.setDisabled(this.disabled);this.setValue(this.value);return M};G.prototype.blur=function(){if(H.prototype.blur.apply(this,arguments)){this.$input.blur()}return false};G.prototype.focus=function(){if(H.prototype.focus.apply(this,arguments)){this.$input.focus()}return false};G.prototype.setDisabled=function(K){this.disabled=K;if(K){this.$input.setAttribute("disabled","disabled")}else{this.$input.removeAttribute("disabled")}};G.prototype.isDisabled=function(){return this.disabled};G.prototype.setValue=function(K){if(this.tagName==="button"){return}this.value=K;this.$input.value=K};G.prototype.getValue=function(){if(this.tagName==="button"){return null}return this.$input.value};var g=function(L,K,M){M=M||{};this.className=L;this.$view=null;this.selected=null;this.data=[];this.indexKey=M.indexKey||null;this.onSelect=M.onSelect||function(P,N,O){};this.onActivate=M.onActivate||function(P,N,O){};this.onContextMenu=M.onContextMenu||function(P,N,O){};this.onViewContextMenu=M.onViewContextMenu||function(N){};this.onCreateItem=M.onCreateItem||function(O,N){};H.apply(this,[K,M])};g.prototype=Object.create(H.prototype);g.prototype.update=function(){H.prototype.update.apply(this,arguments);if(this.opts.data){if(typeof this.opts.render==="undefined"||this.opts.render===true){this.render(this.opts.data)}}};g.prototype.init=function(N,K){var L=this;var M=H.prototype.init.apply(this,[N]);this.$view=document.createElement("div");if(typeof K==="undefined"||K===true){M.appendChild(this.$view);this._addEvent(this.$view,"oncontextmenu",function(O){O.stopPropagation();O.preventDefault();L.onViewContextMenu.call(L,O);return false})}return M};g.prototype.clear=function(){this.render([],true)};g.prototype.refresh=function(){this.render(this.data,false)};g.prototype.render=function(N,M){if(!this.$view){return false}var L=this;var K=null;var O=0;if(!M){if(this.indexKey){if(this.selected){K=this.selected[this.indexKey];O=this.$view.scrollTop}}}if(typeof N!=="undefined"){this.setData(N)}this._onSelect(null,null);this._onRender();if(K){setTimeout(function(){L.setSelected(K,L.indexKey);if(L.$view){L.$view.scrollTop=O}},10)}else{this.$view.scrollTop=0}return true};g.prototype._onRender=function(){};g.prototype.__onSelect=function(M,L,K){if(this.selected&&this.selected._element){OSjs.Utils.$removeClass(this.selected._element,"Active")}this.selected=null;if(L&&L._element){this.selected=L;OSjs.Utils.$addClass(this.selected._element,"Active");if(K){var N=OSjs.Utils.$position(this.selected._element,this.$view);if(N!==null&&(N.top>(this.$view.scrollTop+this.$view.offsetHeight)||(N.top<this.$view.scrollTop))){this.$view.scrollTop=N.top}}}};g.prototype._onSelect=function(M,L,K,N){this.__onSelect(M,L,K);if(typeof N==="undefined"||N===true){if(M!==null&&L!==null){this.onSelect.apply(this,[M,(L?L._element:null),L])}}return this.selected};g.prototype._onActivate=function(L,K,M){if(typeof M==="undefined"||M===true){this.onActivate.apply(this,[L,(K?K._element:null),K])}return K};g.prototype._onContextMenu=function(L,K){this._onSelect(L,K);this.onContextMenu.apply(this,[L,K._element,K]);return K};g.prototype.onKeyPress=function(R){if(this.destroyed){return false}if(!H.prototype.onKeyPress.apply(this,arguments)){return false}var K=[OSjs.Utils.Keys.UP,OSjs.Utils.Keys.DOWN,OSjs.Utils.Keys.LEFT,OSjs.Utils.Keys.RIGHT,OSjs.Utils.Keys.ENTER];if(!OSjs.Utils.inArray(K,R.keyCode)){return true}if(this.className=="TreeView"){return true}R.preventDefault();if(this.selected){var S=this.selected._index;var O=S;var P=this.data.length;var T=1;var N=S;if(this.className=="IconView"){if(this.$view){var L=this.$view.getElementsByTagName("LI")[0];if(L){var M=L.offsetWidth;try{M+=OSjs.Utils.$getStyle(L,"padding-left").replace("px","")<<0;M+=OSjs.Utils.$getStyle(L,"padding-right").replace("px","")<<0;M+=OSjs.Utils.$getStyle(L,"margin-left").replace("px","")<<0;M+=OSjs.Utils.$getStyle(L,"margin-right").replace("px","")<<0}catch(Q){}T=Math.floor(this.$view.offsetWidth/M)}}}if(S>=0&&S<P){if(R.keyCode===OSjs.Utils.Keys.UP){S-=T;if(S<0){S=N}}else{if(R.keyCode===OSjs.Utils.Keys.DOWN){S+=T;if(S>=P){S=N}}else{if(R.keyCode===OSjs.Utils.Keys.LEFT){S--}else{if(R.keyCode===OSjs.Utils.Keys.RIGHT){S++}else{if(R.keyCode===OSjs.Utils.Keys.ENTER){this._onActivate(R,this.data[S]);return true}}}}}if(S!=O){this.setSelectedIndex(S,true)}}}return true};g.prototype.setData=function(L,K){this.data=L;if(K){this.render()}};g.prototype.setSelected=function(N,L,K){if(!L&&!N){this._onSelect(null,null,false);return true}var M=this.getItemByKey(L,N);if(M){this._onSelect(null,M,K);return true}return false};g.prototype.setSelectedIndex=function(K,L){if(this.data[K]){this._onSelect(null,this.data[K],L)}};g.prototype.setItems=function(){this.setData.apply(this,arguments)};g.prototype.getItemByKey=function(M,O){var N=this.data;for(var L=0,K=N.length;L<K;L++){if(N[L][M]==O){return N[L]}}return null};g.prototype.getItem=function(K){return this.data[K]};g.prototype.getSelected=function(){return this.selected};var E=function(M){var L=this;var K=function(P,O){O=O||function(){console.warn("Warning -- you forgot to implement a handler")};if(!O(P)){OSjs.GUI.blurMenu()}};var N=function(U){var P=document.createElement("div");P.className="Menu";P.oncontextmenu=function(Y){Y.preventDefault();return false};P.onmousedown=function(Y){Y.preventDefault();return false};if(U){var V=document.createElement("ul");var Q,T,X,W,O;for(var S=0,R=U.length;S<R;S++){Q=document.createElement("li");Q.className="";if(!U[S].name){U[S].name=(U[S].title||"").replace(/\s/,"_")}if(U[S].name){Q.className="MenuItem_"+U[S].name}if(typeof U[S].onCreate==="function"){U[S].onCreate(Q,U[S])}else{if(U[S].tooltip){Q.title=U[S].tooltip}if(U[S].icon){T=document.createElement("img");T.alt="";T.src=OSjs.API.getThemeResource(U[S].icon,"icon");Q.appendChild(T)}X=document.createElement("span");X.appendChild(document.createTextNode(U[S].title));Q.appendChild(X);if(U[S].disabled){Q.className+=" Disabled"}}if(U[S].menu){Q.className+=" HasSubMenu";W=document.createElement("div");W.className="Arrow";O=N(U[S].menu);Q.appendChild(O);Q.appendChild(W);Q.onmouseover=(function(Y){return function(aa){var Z=this;setTimeout(function(){L.show(Z,Y)},0)}})(O)}else{Q.onclick=(function(Y){return function(Z){if(this.className.match(/Disabled/)){return}if(this.getAttribute("disabled")=="disabled"){return}K(Z,Y.onClick)}})(U[S])}V.appendChild(Q)}P.appendChild(V)}return P};this.$element=N(M)};E.prototype.destroy=function(){if(this.$element){var M=this.$element.getElementsByTagName("UL")[0];if(M){var L=0,K=M.childNodes.length;for(L;L<K;L++){M.childNodes[L].onclick=null;M.childNodes[L].onmousedown=null}}if(this.$element.parentNode){this.$element.parentNode.removeChild(this.$element)}}this.$element=null};E.prototype.show=function(Q,N){var K,O,M,L;if(N){var P=OSjs.Utils.$position(N);if(P.bottom>window.innerHeight){N.style.top=(window.innerHeight-P.bottom)+"px"}if(P.right>window.innerWidth){N.style.left=(window.innerWidth-P.right)+"px"}return}this.$element.style.top=-10000+"px";this.$element.style.left=-10000+"px";document.body.appendChild(this.$element);K=Q.x+this.$element.offsetWidth;O=Q.y+this.$element.offsetHeight;M=Q.x;L=Q.y;if(K>window.innerWidth){M=window.innerWidth-this.$element.offsetWidth}this.$element.style.left=M+"px";if(O>window.innerHeight){L=window.innerHeight-this.$element.offsetHeight}this.$element.style.top=L+"px"};E.prototype.getRoot=function(){return this.$element};E.prototype.setItemDisabled=function(L,N){var K=this.getRoot();var M=K.getElementsByClassName("MenuItem_"+L);M=(M&&M.length)?M[0]:null;if(M){if(N){OSjs.Utils.$addClass(M,"Disabled")}else{OSjs.Utils.$removeClass(M,"Disabled")}return true}return false};var B=function(K,L){L=L||{};this.$ul=null;this.onMenuOpen=L.onMenuOpen||function(){};this.lid=0;this.items=[];H.apply(this,[K,{}])};B.prototype=Object.create(H.prototype);B.prototype.init=function(){var K=H.prototype.init.apply(this,["GUIMenuBar"]);this.$ul=document.createElement("ul");K.appendChild(this.$ul);K.onmousedown=function(L){L.preventDefault();return false};K.oncontextmenu=function(L){return false};return K};B.prototype.addItem=function(N,O,P){if(!this.$ul){return}var K=this;var M={name:"",title:"",disabled:false,element:null};if(typeof N==="string"){M.title=N;M.name=N}else{M.title=N.title||"<undefined>";M.name=N.name||M.title;M.disabled=N.disabled===true}var L=document.createElement("li");L.className="MenuItem_"+this.lid;L.appendChild(document.createTextNode(M.title));if(M.disabled){L.setAttribute("disabled","disabled")}L.onclick=function(S,Q){if(this.hasAttribute("disabled")||this.className.match(/disabled/g)){return}var U={x:S.clientX,y:S.clientY};if(!Q){var R=OSjs.Utils.$position(this);if(R){U.x=R.left;U.y=R.top}}var T=null;if(O&&O.length){T=OSjs.GUI.createMenu(O,U)}K.onMenuOpen.call(K,T,U,(typeof N==="string"?N:M),K)};M.element=L;this.$ul.appendChild(L);this.lid++;this.items.push(M)};B.prototype.createContextMenu=function(L,K){this.$ul.childNodes[K].onclick(L,true)};B.prototype.getItem=function(K){for(var L=0;L<this.items.length;L++){if(this.items[L].name==K){return this.items[L]}}return null};var A=function(K,L){L=L||{};if(L.rows){L.data=L.rows;delete L.rows}this.columns=L.columns||[];this.$head=null;this.$headTop=null;this.$body=null;this.$table=null;this.$tableTop=null;this.$scroll=null;this.lastSelectedDOM=null;this.onCreateItem=L.onCreateItem||function(O,M,N){};this.singleClick=typeof L.singleClick==="undefined"?false:(L.singleClick===true);if(OSjs.Utils.getCompability().touch){this.singleClick=true}g.apply(this,["ListView",K,L])};A.prototype=Object.create(g.prototype);A.prototype.init=function(){var K=g.prototype.init.apply(this,["GUIListView",false]);var S=0;var Q=0;var M=null;var X=this;var O=function(Y){var Z=S+(Y.clientX-Q);if(M>=0&&Z>=16){X.$headTop.rows[0].childNodes[M].width=Z;X.$body.rows[0].childNodes[M].width=Z}};var N=function(Y){document.removeEventListener("mouseup",N,false);document.removeEventListener("mousemove",O,false)};var P=function(Z,Y){Q=Z.clientX;S=Y.offsetWidth;M=Y.parentNode.getAttribute("data-index");document.addEventListener("mouseup",N,false);document.addEventListener("mousemove",O,false)};var L=function(ab,aa){ab.preventDefault();var Z=ab.target;if(Z.tagName==="DIV"){if(aa==="mousedown"&&Z.className==="Resizer"){P(ab,Z.parentNode)}else{if(aa==="click"&&Z.className==="Label"){var Y=Z.parentNode.className.replace("Column_","");X._onColumnClick(ab,Y)}}return false}return true};var W=document.createElement("table");W.className="Body";var U=document.createElement("thead");var R=document.createElement("tbody");var V=document.createElement("table");var T=document.createElement("thead");V.className="Header";this.$scroll=document.createElement("div");this.$scroll.className="Scroll";this.$scroll.appendChild(W);this._addEventListener(V,"mousedown",function(Y){return L(Y,"mousedown")});this._addEventListener(V,"click",function(Y){return L(Y,"click")});this._addEventListener(this.$scroll,"scroll",function(Y){V.style.left=-this.scrollLeft+"px"});this._addEvent(this.$scroll,"oncontextmenu",function(Y){Y.stopPropagation();Y.preventDefault();X.onViewContextMenu.call(X,Y);return false});W.appendChild(U);W.appendChild(R);V.appendChild(T);K.appendChild(V);K.appendChild(this.$scroll);this.$head=U;this.$headTop=T;this.$body=R;this.$table=W;this.$tableTop=V;this.$view=this.$scroll};A.prototype._render=function(X,K){var S=this;var W,T,Q,P,N,M,aa,V,ab,L,Z,Y,U,O,R;N=document.createElement("tr");for(W=0,T=K.length;W<T;W++){aa=K[W];if(typeof aa.visible!=="undefined"&&aa.visible===false){continue}M=document.createElement("td");M.className="Column_"+aa.key;M.setAttribute("data-index",W);O=document.createElement("div");O.className="Label";O.appendChild(document.createTextNode(aa.title));if(typeof aa.resizable==="undefined"||aa.resizable===true){if(W<(T-W)){R=document.createElement("div");R.className="Resizer";O.appendChild(R)}}M.appendChild(O);if(aa.domProperties){for(Y in aa.domProperties){if(aa.domProperties.hasOwnProperty(Y)){M.setAttribute(Y,aa.domProperties[Y])}}}N.appendChild(M)}this.$head.appendChild(N);this.$headTop.appendChild(N);for(W=0,T=X.length;W<T;W++){N=document.createElement("tr");V=X[W];for(Q=0,P=K.length;Q<P;Q++){U=null;aa=K[Q];N.setAttribute("data-"+aa.key,V[aa.key]);if((typeof aa.visible!=="undefined"&&aa.visible===false)){continue}L=(typeof aa.type==="undefined")?"text":aa.type;M=document.createElement("td");M.className="Column_"+aa.key;if(aa.callback){ab=aa.callback(V)}else{ab=V[aa.key]}if(aa.domProperties){for(Y in aa.domProperties){if(aa.domProperties.hasOwnProperty(Y)){M.setAttribute(Y,aa.domProperties[Y])}}}if(L==="image"){Z=document.createElement("img");Z.alt="";Z.src=ab;M.appendChild(Z);N.removeAttribute("data-"+aa.key)}else{if(L==="button"){Z=document.createElement("button");Z.appendChild(document.createTextNode(ab||""));Z.onclick=V.customEvent;M.appendChild(Z);N.removeAttribute("data-"+aa.key)}else{U=document.createElement("span");U.appendChild(document.createTextNode(ab||""));M.appendChild(U)}}N.oncontextmenu=(function(ac){return function(ad){ad.stopPropagation();ad.preventDefault();S._onContextMenu(ad,ac)}})(this.data[W]);if(this.singleClick){N.onclick=(function(ac){return function(ad){S._onSelect(ad,ac);S._onActivate(ad,ac)}})(this.data[W])}else{N.onclick=(function(ac){return function(ad){S._onSelect(ad,ac)}})(this.data[W]);N.ondblclick=(function(ac){return function(ad){S._onActivate(ad,ac)}})(this.data[W])}N.appendChild(M)}this.$body.appendChild(N);this.onCreateItem(N,V,aa);this.data[W]._index=W;this.data[W]._element=N}};A.prototype.render=function(L,K){if(!g.prototype.render.apply(this,arguments)){return}this._render(this.data,this.columns)};A.prototype._onRender=function(){OSjs.Utils.$empty(this.$head);OSjs.Utils.$empty(this.$body);OSjs.Utils.$empty(this.$headTop)};A.prototype._onColumnClick=function(L,K){};A.prototype.addColumn=function(K){this.columns.push(K)};A.prototype.addRow=function(K){this.rows.push(K)};A.prototype.setColumns=function(K){this.columns=K||[]};A.prototype.setRows=function(L,K){this.setData.apply(this,arguments)};var v=function(K,L){L=L||{};this.$area=null;this.strLen=0;G.apply(this,["GUITextarea","textarea",K,L])};v.prototype=Object.create(G.prototype);v.prototype.init=function(){var K=this;var L=G.prototype.init.apply(this,["GUITextarea"]);this._addEvent(this.$input,"onkeypress",function(M){var N=this.value.length;K.hasChanged=(N!=K.strLen)});return L};v.prototype.setValue=function(K){return this.setText(K)};v.prototype.setText=function(K){this.hasChanged=false;if(this.$input){this.$input.value=(K||"");this.strLen=this.$input.value.length;return true}return false};v.prototype.getValue=function(){return this.getText()};v.prototype.getText=function(){return this.$input?this.$input.value:""};v.prototype.focus=function(){if(!H.prototype.focus.apply(this,arguments)){return false}if(this.$input){this.$input.focus()}return true};v.prototype.blur=function(){if(!H.prototype.blur.apply(this,arguments)){return false}if(this.$input){this.$input.blur()}return true};var n=function(M,K,N,L){this.$element=null;this.$canvas=null;this.width=K||100;this.height=N||100;this.onSelect=L||function(Q,P,O){};if(!OSjs.Compability.canvas){throw"Canvas is not supported on your platform!"}H.apply(this,[M,{}])};n.prototype=Object.create(H.prototype);n.prototype.init=function(){var N=H.prototype.init.apply(this,["GUIColorSwatch"]);var M=document.createElement("canvas");M.width=this.width;M.height=this.height;var K=M.getContext("2d");var O=K.createLinearGradient(0,0,K.canvas.width,0);O.addColorStop(0,"rgb(255,   0,   0)");O.addColorStop(0.15,"rgb(255,   0, 255)");O.addColorStop(0.33,"rgb(0,     0, 255)");O.addColorStop(0.49,"rgb(0,   255, 255)");O.addColorStop(0.67,"rgb(0,   255,   0)");O.addColorStop(0.84,"rgb(255, 255,   0)");O.addColorStop(1,"rgb(255,   0,   0)");K.fillStyle=O;K.fillRect(0,0,K.canvas.width,K.canvas.height);O=K.createLinearGradient(0,0,0,K.canvas.height);O.addColorStop(0,"rgba(255, 255, 255, 1)");O.addColorStop(0.5,"rgba(255, 255, 255, 0)");O.addColorStop(0.5,"rgba(0,     0,   0, 0)");O.addColorStop(1,"rgba(0,     0,   0, 1)");K.fillStyle=O;K.fillRect(0,0,K.canvas.width,K.canvas.height);var L=this;M.addEventListener("click",function(R){var T=OSjs.Utils.$position(M);var P=typeof R.offsetX==="undefined"?(R.clientX-T.left):R.offsetX;var S=typeof R.offsetY==="undefined"?(R.clientY-T.top):R.offsetY;var Q=K.getImageData(P,S,1,1).data;L.onSelect.call(L,Q[0],Q[1],Q[2])},false);N.appendChild(M);this.$element=N;this.$canvas=M;return N};var d=function(K){this.$contents=null;H.apply(this,[K])};d.prototype=Object.create(H.prototype);d.prototype.init=function(){var K=H.prototype.init.apply(this,["GUIStatusBar"]);this.$contents=document.createElement("div");this.$contents.className="Contents";K.appendChild(this.$contents);if(this.opts.value){this.setText(value)}return K};d.prototype.setText=function(K){this.$contents.innerHTML=K};d.prototype.appendChild=function(K){this.$contents.appendChild(K)};var u=function(L,M){this.min=M.min||0;this.max=M.max||0;this.val=M.val||0;this.type=M.orientation||"horizontal";this.steps=M.steps||1;this.onChange=M.onChange||function(){};this.$root=null;this.$button=null;var K=this;this.onUpdate=function(O,N){(M.onUpdate||function(Q,P){console.warn("GUIScroll onUpdate() missing...",Q,"("+P+"%)")}).apply(K,arguments);K.onChange.apply(this,arguments)};H.apply(this,[L,{}])};u.prototype=Object.create(H.prototype);u.prototype.init=function(){var N=H.prototype.init.apply(this,["GUISlider"]);N.className+=" "+this.type;this.$root=document.createElement("div");this.$root.className="Root";this.$button=document.createElement("div");this.$button.className="Button";var Q=false;var R=0;var O=0;var T=0;var S=0;var M=0;var K=0;var W=0;var V=this;var L=function(Z){if(!Q){return}var ab,aa;if(V.type=="horizontal"){var Y=(Z.clientX-R);ab=T+Y;ab=W*Math.round(ab/W);if(ab<0){ab=0}if(ab>M){ab=M}V.$button.style.left=ab+"px"}else{var X=(Z.clientY-O);aa=S+X;aa=W*Math.round(aa/W);if(aa<0){aa=0}if(aa>K){aa=K}V.$button.style.top=aa+"px"}V.onSliderUpdate(ab,aa,M,K,"mousemove")};var P=function(X){Q=false;document.removeEventListener("mousemove",L,false);document.removeEventListener("mouseup",P,false);var Y=(V.max/100)*V.val;V.onChange.call(V,V.val,Y,"mouseup")};var U=function(X){X.preventDefault();Q=true;if(V.type=="horizontal"){R=X.clientX;T=V.$button.offsetLeft;M=V.$element.offsetWidth-V.$button.offsetWidth;W=(V.$element.offsetWidth/((V.max-V.min)/V.steps))}else{O=X.clientY;S=V.$button.offsetTop;K=V.$element.offsetHeight-V.$button.offsetHeight;W=(V.$element.offsetHeight/((V.max-V.min)/V.steps))}document.addEventListener("mousemove",L,false);document.addEventListener("mouseup",P,false)};this._addEventListener(this.$button,"mousedown",function(X){return U(X)});this._addEventListener(N,"click",function(Y){if(Y.target&&Y.target.className==="Button"){return}var Z=OSjs.Utils.$position(N);var X=Y.clientX-Z.left;var aa=Y.clientY-Z.top;V.onSliderClick(Y,X,aa,(V.$element.offsetWidth-(V.$button.offsetWidth/2)),(V.$element.offsetHeight-(V.$button.offsetHeight/2)))});N.appendChild(this.$root);N.appendChild(this.$button);return N};u.prototype.update=function(){H.prototype.update.apply(this,arguments);this.setValue(this.val)};u.prototype.setPercentage=function(L,K){L=L<<0;var N=(this.max-this.min);var M=(N*(L/100))<<0;this.val=M;this.onUpdate.call(this,M,L,K)};u.prototype.onSliderClick=function(O,K,R,L,N){var Q=(this.max-this.min);var M;if(this.type=="horizontal"){M=(K/L)*100}else{M=(R/N)*100}var P=(Q*(M/100))<<0;this.setValue(P);this.setPercentage(M,"click")};u.prototype.onSliderUpdate=function(K,P,O,M,L){var N=null;if(typeof K!=="undefined"){N=(K/O)*100}else{if(typeof P!=="undefined"){N=(P/M)*100}}if(N!==null){this.setPercentage(N,L)}};u.prototype.setValue=function(M){if(!this.inited){return}if(M<this.min||M>this.max){return}this.val=M;var N=(this.max-this.min);var R=this.val/(N/100);if(this.type=="horizontal"){var L=this.$element.offsetWidth;var T=this.$button.offsetWidth;var K=(L-T);var O=(K/100)*R;this.$button.style.left=O+"px"}else{var U=this.$element.offsetHeight;var P=this.$button.offsetHeight;var Q=(U-P);var S=(Q/100)*R;this.$button.style.top=S+"px"}};u.prototype.getValue=function(){return this.val};var J=function(K,L){L=L||{};this.$container=null;this.$active=null;this.items={};this.orientation=L.orientation||"horizontal";H.apply(this,[K,{}])};J.prototype=Object.create(H.prototype);J.prototype.init=function(){var K=H.prototype.init.apply(this,["GUIToolbar"]);this.$container=document.createElement("ul");this.$container.className="Container";K.className+=" "+this.orientation;K.appendChild(this.$container);return K};J.prototype.addItem=function(K,L){this.items[K]=L};J.prototype.addSeparator=(function(){var K=1;return function(){this.items["separator_"+K]=null;K++}})();J.prototype.render=function(){if(!this.$container){return}var P,N,L,O,Q;var K=this;for(var M in this.items){if(this.items.hasOwnProperty(M)){Q=this.items[M]||null;P=document.createElement("li");if(!Q){P.className="Separator "+M;this.$container.appendChild(P);continue}P.className="Item "+M;switch(Q.type){case"custom":N=document.createElement("div");break;default:N=document.createElement("button");break}if(typeof Q.onCreate==="function"){Q.onCreate.call(this,M,Q,P,N)}else{if(Q.icon){L=document.createElement("img");L.alt="";L.src=Q.icon;N.appendChild(L);P.className+=" HasIcon"}if(Q.title){O=document.createElement("span");O.appendChild(document.createTextNode(Q.title));N.appendChild(O);P.className+=" HasTitle"}}if(Q.tooltip&&!N.title){N.title=Q.tooltip}N.onclick=(function(R,S){return function(T){if(S.grouped){OSjs.Utils.$removeClass(K.$active,"Active");K.$active=this;OSjs.Utils.$addClass(K.$active,"Active")}K._onItemSelect(T,this,R,S)}})(M,Q);P.appendChild(N);this.$container.appendChild(P)}}};J.prototype._onItemSelect=function(N,L,K,M){if(M&&M.onClick){M.onClick(N,L,K,M)}};J.prototype.getItem=function(L){if(this.$container){var N=this.$container.childNodes;for(var M=0,K=N.length;M<K;M++){if((new RegExp(L)).test(N[M].className)){return N[M]}}}return null};var s=function(L,K){this.$container=null;this.$bar=null;this.$label=null;this.percentage=K||0;H.apply(this,[L,{}])};s.prototype=Object.create(H.prototype);s.prototype.init=function(){var K=H.prototype.init.apply(this,["GUIProgressBar"]);this.$container=document.createElement("div");this.$container.className="Container";this.$bar=document.createElement("div");this.$bar.className="Bar";this.$container.appendChild(this.$bar);this.$label=document.createElement("div");this.$label.className="Label";this.$container.appendChild(this.$label);K.appendChild(this.$container);this.setPercentage(this.percentage);return K};s.prototype.setPercentage=function(K){if(K<0||K>100){return}this.percentage=(K<<0);this.$bar.style.width=this.percentage+"%";this.$label.innerHTML=this.percentage+"%"};s.prototype.setProgress=function(K){this.setPercentage(K)};var t=function(K,L){L=L||{};if(!OSjs.Compability.canvas){throw"Your platform does not support canvas :/"}this.$canvas=null;this.$context=null;this.width=L.width||null;this.height=L.height||null;this.type=L.type||"image/png";H.apply(this,[K,{}])};t.prototype=Object.create(H.prototype);t.prototype.init=function(){var K=H.prototype.init.apply(this,["GUICanvas"]);this.$canvas=document.createElement("canvas");if(this.width!==null){this.$canvas.width=this.width;this.$element.style.width=this.width+"px"}if(this.height!==null){this.$canvas.height=this.height;this.$element.style.height=this.height+"px"}this.$context=this.$canvas.getContext("2d");K.appendChild(this.$canvas);return K};t.prototype.clear=function(){if(this.$context){this.$context.clearRect(0,0,this.width,this.height);return true}return false};t.prototype.fillColor=function(K){this.$context.fillStyle=K;this.$context.fillRect(0,0,this.width,this.height)};t.prototype.resize=function(K,L){this.width=K;this.height=L;this.$canvas.width=K;this.$canvas.height=L;this.$element.style.width=K+"px";this.$element.style.height=L+"px"};t.prototype.func=function(L,K){if(!L||!K){throw"Canvas::func() expects a function name and arguments"}if(this.$canvas&&this.$context){return this.$context[L].apply(this.$context,K)}return null};t.prototype.setImageData=function(K,M,O){if(!this.$context){return}M=M||function(){};O=O||function(){};var Q=this;var N=new Image();var S=this.$canvas;var R=this.$context;var L=null;try{L=K.split(/;/)[0].replace(/^data\:/,"")}catch(P){throw"Cannot setImageData() invalid or no mime"}this.type=L;N.onload=function(){Q.resize(this.width,this.height);R.drawImage(N,0,0);M.apply(Q,arguments)};N.onerror=function(){O.apply(Q,arguments)};N.src=K};t.prototype.getCanvas=function(){return this.$canvas};t.prototype.getContext=function(){return this.$context};t.prototype.getColorAt=function(K,P){var O=this.$context.getImageData(0,0,this.$canvas.width,this.$canvas.height).data;var M=((K+P*this.$canvas.width)*4);var L={r:O[M+0],g:O[M+1],b:O[M+2],a:O[M+3]};var N=OSjs.Utils.RGBtoHEX(L);return{rgb:L,hex:N}};t.prototype.getImageData=function(K){if(this.$context&&this.$canvas){K=K||this.type;return this.$canvas.toDataURL(K)}return null};var b=function(K,L){L=L||{};this.$ul=null;this.iconSize=L.size||"32x32";this.singleClick=typeof L.singleClick==="undefined"?false:(L.singleClick===true);if(OSjs.Utils.getCompability().touch){this.singleClick=true}g.apply(this,["IconView",K,L])};b.prototype=Object.create(g.prototype);b.prototype.init=function(){var L=this;var M=g.prototype.init.apply(this,["GUIIconView"]);var K=this.$view;M.className+=" IconSize"+this.iconSize;this.$ul=document.createElement("ul");this._addEvent(K,"onclick",function(O){var N=O.target||O.srcElement;if(N&&N==K){L.setSelected(null,null)}});K.appendChild(this.$ul);M.appendChild(K);return M};b.prototype._onRender=function(){OSjs.Utils.$empty(this.$ul)};b.prototype._render=function(){var L=function(W){return OSjs.API.getThemeResource(W,"icon")};var P,M,T,U,K,Q,S,R;var N,O;var V=this;for(P=0,M=this.data.length;P<M;P++){T=this.data[P];K=null;U=document.createElement("li");U.setAttribute("data-index",P);for(var N in T){if(T.hasOwnProperty(N)){if(!OSjs.Utils.inArray(["title","icon"],N)){U.setAttribute("data-"+N,T[N])}}}if(T.icon){K=document.createElement("div");Q=document.createElement("img");Q.alt="";Q.title="";Q.src=L(T.icon);K.appendChild(Q)}S=document.createElement("div");R=document.createElement("span");R.appendChild(document.createTextNode(T.label));S.appendChild(R);U.oncontextmenu=(function(W){return function(X){X.stopPropagation();X.preventDefault();V._onContextMenu(X,W)}})(T);if(this.singleClick){U.onclick=(function(W){return function(X){V._onSelect(X,W);V._onActivate(X,W)}})(T)}else{U.onclick=(function(W){return function(X){V._onSelect(X,W)}})(T);U.ondblclick=(function(W){return function(X){V._onActivate(X,W)}})(T)}if(K){U.appendChild(K)}U.appendChild(S);this.$ul.appendChild(U);this.onCreateItem(U,T);this.data[P]._element=U;this.data[P]._index=P}};b.prototype.render=function(L,K){if(!g.prototype.render.call(this,L,K)){return}this._render()};var f=function(K,M){M=M||{};var L=false;if(M.expanded===true){L=true}else{if(M.expanded>=0){L=M.expand}}this.total=0;this.expandLevel=L;this.onExpand=M.onExpand||function(P,N,O){};this.onCollapse=M.onCollapse||function(P,N,O){};this.singleClick=typeof M.singleClick==="undefined"?false:(M.singleClick===true);if(OSjs.Utils.getCompability().touch){this.singleClick=true}g.apply(this,["TreeView",K,M])};f.prototype=Object.create(g.prototype);f.prototype.init=function(){var K=g.prototype.init.call(this,"GUITreeView");return K};f.prototype._render=function(N,K,P,M){var L=this;var O=function(W,Y,X,Q){if(typeof Q==="undefined"){Q=false}if(!X){X=document.createElement("ul");X.className="Level_"+(Q||0)}var ab,Z,S,V,aa,R,ac,T;for(var U=0;U<W.length;U++){ab=document.createElement("li");ac=document.createElement("div");Z=W[U]||{};Z.name=Z.name||"treeviewitem_"+this.total;Z.title=Z.title||Z.name;ab.className="Item Level_"+(Q||0);ab.setAttribute("data-index",U);for(T in Z){if(Z.hasOwnProperty(T)){if(!OSjs.Utils.inArray(["items","title","icon"],T)){ab.setAttribute("data-"+T,Z[T])}}}Z._element=ab;if(Z.items&&Z.items.length){ab.className+=" Expandable";S=document.createElement("div");S.className="Expander";S.innerHTML="";ac.appendChild(S)}else{S=null}if(Z.icon){V=document.createElement("img");V.src=Z.icon;V.alt="";ac.appendChild(V)}aa=document.createElement("span");aa.appendChild(document.createTextNode(Z.title));ac.appendChild(aa);ac.oncontextmenu=(function(ae,ad){return function(af){af.stopPropagation();af.preventDefault();if(ad){af.stopPropagation()}L._onContextMenu(af,ae);return false}})(Z,!S);if(this.singleClick){ac.onclick=(function(ae,ad){return function(af){if(ad){af.stopPropagation()}L._onSelect(af,ae);L._onActivate(af,ae)}})(Z,!S)}else{ac.onclick=(function(ae,ad){return function(af){if(ad){af.stopPropagation()}L._onSelect(af,ae)}})(Z,!S);ac.ondblclick=(function(ae,ad){return function(af){if(ad){af.stopPropagation()}L._onActivate(af,ae)}})(Z,!S)}ab.appendChild(ac);if(S){R=O.call(L,Z.items,ab,null,Q+1);if(this.expandLevel===true||(Q!==false&&this.expandLevel>=Q)){R.style.display="block"}S.onclick=(function(af,ae,ad){return function(ah){var ag=af.style.display;if(ag==="none"||ag===""){af.style.display="block";OSjs.Utils.$addClass(ae,"Expanded");L._onExpand.call(L,ah,ad)}else{af.style.display="none";OSjs.Utils.$removeClass(ae,"Expanded");L._onCollapse.call(L,ah,ad)}}})(R,ab,Z)}this.total++;X.appendChild(ab);if(this.onCreateItem){this.onCreateItem(ab,Z)}}Y.appendChild(X);return X};return O.call(this,N,K,M,P)};f.prototype.render=function(L,K){if(!g.prototype.render.call(this,L,K)){return}};f.prototype._onRender=function(){OSjs.Utils.$empty(this.$view);this._render(this.data,this.$view)};f.prototype._onExpand=function(L,K){this.onExpand.apply(this,[L,(K?K._element:null),K])};f.prototype._onCollapse=function(L,K){this.onCollapse.apply(this,[L,(K?K._element:null),K])};f.prototype.onKeyPress=function(K){};f.prototype.setData=function(L,K){this.total=0;g.prototype.setData.apply(this,arguments)};f.prototype.getItemByKey=function(K,M){var L=function(P){var N=null;for(var O in P){if(P.hasOwnProperty(O)){if(P[O][K]==M){return P[O]}if(P[O].items){N=L(P[O].items);if(N){return N}}}}return null};return L.call(this,this.data)};var z=function(K,L){L=L||{};if(!OSjs.Compability.richtext){throw"Your platform does not support RichText editing"}this.$view=null;this.opts=L||{};this.opts.fontName=this.opts.fontName||"Arial";this.opts.onInited=this.opts.onInited||function(){};this.loadContent=null;H.apply(this,[K,L])};z.prototype=Object.create(H.prototype);z.prototype.init=function(){var K=H.prototype.init.apply(this,["GUIRichText"]);this.$view=document.createElement("iframe");this.$view.setAttribute("border","0");K.appendChild(this.$view);return K};z.prototype.update=function(){H.prototype.update.apply(this,arguments);var K=this;var M='<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/themes/default.css" /></head><body contentEditable="true"></body></html>';var O;try{O=this.getDocument();O.open();O.write(M);O.close()}catch(L){console.error("Failed to write RichText template",L)}if(O){O.body.style.fontFamily=this.opts.fontName;try{this.$view.execCommand("styleWithCSS",false,false)}catch(N){try{this.$view.execCommand("useCSS",false,null)}catch(N){try{this.$view.execCommand("styleWithCSS",false,false)}catch(N){}}}try{this.$view.contentWindow.onfocus=function(){K.focus()};this.$view.contentWindow.onblur=function(){K.blur()}}catch(N){console.warn("Failed to bind focus/blur on richtext",N)}if(this.opts.onInited){this.opts.onInited.apply(this,[])}if(this.loadContent){this.loadContent();this.loadContent=null}}};z.prototype.command=function(L,P,K){var O=this.getDocument();if(O){var N=[];if(typeof L!=="undefined"){N.push(L)}if(typeof P!=="undefined"){N.push(P)}if(typeof K!=="undefined"){N.push(K)}try{return O.execCommand.apply(O,N)}catch(M){console.warn("OSjs.GUI.RichText::command() failed",L,P,K,M)}}return false};z.prototype.setContent=function(L){this.hasChanged=false;var K=this.getDocument();if(K&&K.body){K.body.innerHTML=L;return true}return false};z.prototype.getContent=function(){var K=this;function L(){var M=K.getDocument();if(M&&M.body){return M.body.innerHTML}return null}if(!this.inited){this.loadContent=L;return null}return L()};z.prototype.getDocument=function(){if(this.$view){return this.$view.contentDocument||this.$view.contentWindow.document}return null};z.prototype.blur=function(){if(!H.prototype.blur.apply(this,arguments)){return false}if(this.$view&&this.$view.contentWindow){this.$view.contentWindow.blur()}return true};z.prototype.focus=function(){if(!H.prototype.focus.apply(this,arguments)){return false}if(this.$view&&this.$view.contentWindow){this.$view.contentWindow.focus()}return true};var p=function(O,P,N,K,Q,M){var L=this;P=P||{};P.title=P.title||{};P.onCreate=P.onCreate||function(){};P.onSelect=P.onSelect||function(){};P.onUnselect=P.onUnselect||function(){};P.onDestroy=P.onDestroy||function(){};P.onClose=P.onClose||function(){return true};this.$c=document.createElement("div");this.$c.className="TabContent";this.$t=document.createElement("div");this.$t.className="Tab";this.$t.innerHTML="<span>&nbsp;</span>";this.$t.onclick=function(R){M.setTab(O)};this.$x=null;if(P.closeable){this.$x=document.createElement("span");this.$x.className="Close";this.$x.innerHTML="X";this.$x.onclick=function(R){R.stopPropagation();if(P.onClose(R,L)===true){M.removeTab(O)}};this.$t.appendChild(this.$x);this.$t.className+=" HasClose"}this.name=O;this.selected=false;this.index=N;this.params=P;this.setTitle(P.title);K.appendChild(this.$t);Q.appendChild(this.$c);this.params.onCreate.call(this)};p.prototype.destroy=function(){this.params.onDestroy.call(this);if(this.$x){this.$x.onclick=null;if(this.$x.parentNode){this.$x.parentNode.removeChild(this.$x)}this.$x=null}if(this.$c){if(this.$c.parentNode){this.$c.parentNode.removeChild(this.$c)}this.$c=null}if(this.$t){this.$t.onclick=null;if(this.$t.parentNode){this.$t.parentNode.removeChild(this.$t)}this.$t=null}};p.prototype.select=function(){if(this.selected||!this.$c||!this.$t){return}OSjs.Utils.$addClass(this.$c,"Active");OSjs.Utils.$addClass(this.$t,"Active");this.selected=true;this.params.onSelect.call(this)};p.prototype.unselect=function(){if(!this.selected||!this.$c||!this.$t){return}OSjs.Utils.$removeClass(this.$c,"Active");OSjs.Utils.$removeClass(this.$t,"Active");this.selected=false;this.params.onUnselect.call(this)};p.prototype.appendChild=function(K){if(this.$c){this.$c.appendChild(K)}};p.prototype.setTitle=function(K){this.params.title=K;if(this.$t){this.$t.firstChild.innerHTML="";this.$t.firstChild.appendChild(document.createTextNode(this.params.title))}};p.prototype.getTitle=function(K){return this.params.title};var a=function(K,L){L=L||{};this.$container=null;this.$tabs=null;this.orientation=L.orientation||"horizontal";this.tabs={};this.tabCount=0;this.currentTab=null;H.apply(this,[K,L])};a.prototype=Object.create(H.prototype);a.prototype.init=function(){var K=this;var L=H.prototype.init.apply(this,["GUITabs"]);OSjs.Utils.$addClass(L,OSjs.Utils.$safeName(this.orientation));this.$container=document.createElement("div");this.$container.className="TabContents";this.$tabs=document.createElement("div");this.$tabs.className="Tabs";L.appendChild(this.$tabs);L.appendChild(this.$container);return L};a.prototype.destroy=function(){for(var K in this.tabs){if(this.tabs.hasOwnProperty(K)&&this.tabs[K]){this.tabs[K].destroy()}}this.tabs={};H.prototype.destroy.apply(this,arguments)};a.prototype.setTab=function(K){console.debug("OSjs::GUI::Tabs::setTab()",K);if(this.tabs[K]){if(this.currentTab){this.currentTab.unselect();this.currentTab=null}this.currentTab=this.tabs[K];this.currentTab.select()}};a.prototype.removeTab=function(K){console.debug("OSjs::GUI::Tabs::removeTab()",K);if(K instanceof p){K=K.name}if(this.tabs[K]){this.tabs[K].destroy();delete this.tabs[K];this.tabCount--}this.selectFirstTab()};a.prototype.selectFirstTab=function(){if(!this.$tabs||!this.$container){return}var L=false;for(var K in this.tabs){if(this.tabs.hasOwnProperty(K)&&this.tabs[K]!==null){L=K;break}}if(L!==false){this.setTab(L)}};a.prototype.addTab=function(L,N){var K=this;console.debug("OSjs::GUI::Tabs::addTab()",L,N);var M=new p(L,N,this.tabCount,this.$tabs,this.$container,this);this.tabs[L]=M;this.tabCount++;if(this.inited&&this.tabCount>0){this.setTab(L)}return M};a.prototype.update=function(){if(!this.inited){this.selectFirstTab()}H.prototype.update.apply(this,arguments)};var l=function(K,L){L=L||{};L.type=L.type||"text";G.apply(this,["GUIText","input",K,L])};l.prototype=Object.create(G.prototype);l.prototype.select=function(K){if(this.$input){if(K){try{if(typeof K!=="object"){K={}}if(typeof K.min==="undefined"||!K.min){K.min=0}if(typeof K.max==="undefined"||!K.max||K.max<K.min){K.max=this.getValue().length-1}OSjs.Utils.$selectRange(this.$input,K.min,K.max)}catch(L){console.warn("OSjs::GUI::Text::select()","exception",L);this.$input.select()}}else{this.$input.select()}}};var r=function(K,L){L=L||{};L.type="checkbox";this.label=L.label||"GUICheckbox Label";this.$label=null;G.apply(this,["GUICheckbox","input",K,L])};r.prototype=Object.create(G.prototype);r.prototype.init=function(){var K=this;var L=H.prototype.init.apply(this,[this.className]);this.$input=document.createElement(this.tagName);this.$input.type=this.type;this._addEvent(this.$input,"onchange",function(M){K.onChange.apply(K,[this,M,K.getValue()])});this.$label=document.createElement("label");this.$label.appendChild(this.$input);this.$label.appendChild(document.createTextNode(this.label));L.appendChild(this.$label);this.setDisabled(this.disabled);this.setValue(this.value);return L};r.prototype.setChecked=function(K){this.setValue(K)};r.prototype.setValue=function(K){this.value=K?true:false;if(this.value){this.$input.setAttribute("checked","checked")}else{this.$input.removeAttribute("checked")}};r.prototype.getValue=function(){return this.$input.checked?true:false};var k=function(K,L){L=L||{};L.type="radio";this.group=L.group||"GUIRadioDefaultGroup";this.label=L.label||"GUIRadio Label";this.$label=null;G.apply(this,["GUICheckbox","input",K,L])};k.prototype=Object.create(r.prototype);k.prototype.init=function(){var K=r.prototype.init.apply(this,[this.className]);this.$input.name=this.group;return K};var h=function(K,L){G.apply(this,["GUISelect","select",K,L])};h.prototype=Object.create(G.prototype);h.prototype.addItems=function(K){for(var L in K){if(K.hasOwnProperty(L)){this.addItem(L,K[L])}}};h.prototype.addItem=function(M,K){var L=document.createElement("option");L.value=M;L.appendChild(document.createTextNode(K));this.$input.appendChild(L)};h.prototype.setValue=function(K){this.setSelected(K)};h.prototype.setSelected=function(N){var L=0;var K=this.$input.childNodes.length;var M=false;for(L;L<K;L++){if(L===N||this.$input.childNodes[L].value==N){M=L;break}}if(M!==false){this.$input.selectedIndex=M;this.value=M}};var q=function(K,L){G.apply(this,["GUISelectList","select",K,L])};q.prototype=Object.create(G.prototype);q.prototype.init=function(){var K=G.prototype.init.apply(this,[this.className]);this.$input.multiple="multiple";return K};q.prototype.addItems=function(K){for(var L in K){if(K.hasOwnProperty(L)){this.addItem(L,K[L])}}};q.prototype.addItem=function(M,K){var L=document.createElement("option");L.value=M;L.appendChild(document.createTextNode(K));this.$input.appendChild(L)};q.prototype.setValue=function(K){this.setSelected(K)};q.prototype.setSelected=function(N){if(!this.$input){return}var M=[];if(N instanceof Array){M=N}else{M=[N]}var L=0;var K=this.$input.childNodes.length;for(L;L<K;L++){this.$input.childNodes[L].removeAttribute("selected");if(OSjs.Utils.inArray(M,this.$input.childNodes[L].value)){this.$input.childNodes[L].setAttribute("selected","selected")}}};q.prototype.getValue=function(){var M=[];if(this.$input){var L=0;var K=this.$input.childNodes.length;for(L;L<K;L++){if(this.$input.childNodes[L].selected){M.push(this.$input.childNodes[L].value)}}}return M};var F=function(K,L){G.apply(this,["GUIButton","button",K,L])};F.prototype=Object.create(G.prototype);var o=function(K,L){L=L||{};L.focusable=false;L.label=L.label||L.value||"GUILabel";H.apply(this,[K,L])};o.prototype=Object.create(H.prototype);o.prototype.init=function(){var K=H.prototype.init.apply(this,["GUILabel","label"]);K.appendChild(document.createTextNode(this.opts.label));if(this.opts.forInput){K.setAttribute("for",this.opts.forInput)}return K};var y=function(K,L){L=L||{};if(typeof L.scrollX==="undefined"){L.scrollX=true}if(typeof L.scrollY==="undefined"){L.scrollY=true}H.apply(this,[K,L])};y.prototype=Object.create(H.prototype);y.prototype.init=function(){var K=H.prototype.init.apply(this,["GUIScrollView"]);return K};y.prototype.update=function(){H.prototype.update.apply(this,arguments);this.setScroll(this.opts.scrollX,this.opts.scrollY)};y.prototype.addElement=function(L,K){if(K){OSjs.Utils.$empty(this.$element)}this.$element.appendChild(L)};y.prototype.setScroll=function(K,M){var L=["GUIScrollView",OSjs.Utils.$safeName(this.name)];if(K){L.push("ScrollX")}if(M){L.push("ScrollY")}this.opts.scrollX=K;this.opts.scrollY=M;this.getRoot().className=L.join(" ")};var w=function(K,L){L=L||{};L.direction=(L.direction||L.orientation)||"horizontal";this.$container=null;this.$separator=null;H.apply(this,[K,L])};w.prototype=Object.create(H.prototype);w.prototype.init=function(){var L=H.prototype.init.apply(this,["GUIPanedView"]);var K=this.opts.direction==="horizontal"?"Horizontal":"Vertical";OSjs.Utils.$addClass(L,OSjs.Utils.$safeName(K));this.$container=document.createElement("ul");L.appendChild(this.$container);return L};w.prototype.update=function(){H.prototype.update.apply(this,arguments)};w.prototype.createView=function(L){if(this.$container.childNodes.length%2){var Q=document.createElement("li");Q.className="Separator";var S=0;var R=0;var T=this.$container.childNodes.length-1;var M=this.$container.childNodes[T];var P=function(U){var V=S+(U.clientX-R);M.style.width=V+"px"};var N=function(U){document.removeEventListener("mouseup",N,false);document.removeEventListener("mousemove",P,false)};var O=function(V,U){R=V.clientX;S=M.offsetWidth;document.addEventListener("mouseup",N,false);document.addEventListener("mousemove",P,false)};this._addEventListener(Q,"mousedown",function(U){U.preventDefault();return O(U)});this.$container.appendChild(Q);this.$separator=Q}var K=document.createElement("li");K.className="View "+L;this.$container.appendChild(K);return K};w.prototype.addItem=function(M,L){var K=this.createView(L);if(M){if(M instanceof H){K.appendChild(M.getRoot())}else{K.appendChild(M)}}};var i=function(M,K,L){L=L||{};if(typeof L.dnd==="undefined"){L.dnd=true}f.apply(this,[K,L]);this.onActivated=function(P,N,O){};this.onSelected=function(O,N){};this.onDropped=function(){console.warn("Not implemented yet!")};this.fileView=M};i.prototype=Object.create(f.prototype);i.prototype.init=function(){f.prototype.init.apply(this,arguments);var K=this;if(this.opts.dnd&&this.opts.dndDrag&&OSjs.Compability.dnd){this.onCreateItem=function(M,N){var L=this;if(N.filename==".."){return}if(N.type==="file"){M.title=([OSjs._("Filename")+": "+N.filename,OSjs._("Path")+": "+N.path,OSjs._("Size")+": "+N.size||0,OSjs._("MIME")+": "+N.mime||"none"]).join("\n");x(M,{type:"file",source:{wid:L.wid},data:{type:"file",filename:N.filename,path:N.path,size:N.size,mime:N.mime}})}else{if(N.type=="dir"){M.title=N.path;I(M,{onItemDropped:function(R,P,Q,O){return L.onItemDropped.call(L,R,P,Q,O)},onFilesDropped:function(R,P,Q,O){return L.onFilesDropped.call(L,R,P,N,O)}})}}}}};i.prototype._createList=function(P,O){var L=[];var N=function(Q){var R="status/gtk-dialog-question.png";return j(Q.filename,Q.mime,Q.type,R,"16x16")};var K;for(var M=0;M<P.length;M++){K=P[M];if(O&&K.filename==".."){continue}K.title=K.filename;K.icon=N(K);K._loaded=false;if(K.type=="dir"&&K.filename!=".."){K.items=[{icon:K.icon,title:"Loading..."}]}L.push(K)}return L};i.prototype.render=function(M,L){if(this.destroyed){return}var K=this._createList(M);f.prototype.render.apply(this,[K,true])};i.prototype._onSelect=function(L,K){K=f.prototype._onSelect.apply(this,arguments);if(K&&K.path){this.onSelected(K.path,K.type,K.mime)}};i.prototype._onActivate=function(L,K){K=f.prototype._onActivate.apply(this,arguments);if(K&&K.path){this.onActivated(K.path,K.type,K.mime)}};i.prototype._onExpand=function(M,L){f.prototype._onActivate.apply(this,arguments);if(L._loaded){return}if(this.fileView&&L&&L.path&&L._element){var N=this.fileView;var K=this;N._getDir(L.path,function(T,Q,P,S){var R=L._element.getElementsByTagName("UL")[0];if(R){OSjs.Utils.$empty(R)}var U=L._element.className.replace("Level_","")<<0;var O=K._createList(T,true);K._render(O,L._element,U+1,R);R.style.display="block"});L._loaded=true}};var c=function(M,K,L){L=L||{};if(typeof L.dnd==="undefined"){L.dnd=true}b.apply(this,[K,L]);this.onActivated=function(P,N,O){};this.onSelected=function(O,N){};this.onDropped=function(){console.warn("Not implemented yet!")};this.fileView=M};c.prototype=Object.create(b.prototype);c.prototype.init=function(){b.prototype.init.apply(this,arguments);var K=this;if(this.opts.dnd&&this.opts.dndDrag&&OSjs.Compability.dnd){this.onCreateItem=function(M,N){var L=this;if(N.filename==".."){return}if(N.type==="file"){M.title=([OSjs._("Filename")+": "+N.filename,OSjs._("Path")+": "+N.path,OSjs._("Size")+": "+N.size||0,OSjs._("MIME")+": "+N.mime||"none"]).join("\n");x(M,{type:"file",source:{wid:L.wid},data:{type:"file",filename:N.filename,path:N.path,size:N.size,mime:N.mime}})}else{if(N.type=="dir"){M.title=N.path;I(M,{onItemDropped:function(R,P,Q,O){return L.onItemDropped.call(L,R,P,Q,O)},onFilesDropped:function(R,P,Q,O){return L.onFilesDropped.call(L,R,P,N,O)}})}}}}};c.prototype.render=function(P,M){if(this.destroyed){return}var L=[];var O=function(Q){var R="status/gtk-dialog-question.png";return j(Q.filename,Q.mime,Q.type,R,"32x32")};var K;for(var N=0;N<P.length;N++){K=P[N];K.label=K.filename;K.icon=O(K);L.push(K)}b.prototype.render.apply(this,[L,true])};c.prototype._onSelect=function(L,K){K=b.prototype._onSelect.apply(this,arguments);if(K&&K.path){this.onSelected(K.path,K.type,K.mime)}};c.prototype._onActivate=function(L,K){K=b.prototype._onActivate.apply(this,arguments);if(K&&K.path){this.onActivated(K.path,K.type,K.mime)}};var D=function(M,K,L){L=L||{};if(typeof L.dnd==="undefined"){L.dnd=true}A.apply(this,[K,L]);this.humanSize=(typeof L.humanSize==="undefined"||L.humanSize);this.onActivated=function(P,N,O){};this.onSelected=function(O,N){};this.onDropped=function(){console.warn("Not implemented yet!")};this.onSort=function(){console.warn("Not implemented yet!")};this.fileView=M};D.prototype=Object.create(A.prototype);D.prototype.init=function(){A.prototype.init.apply(this,arguments);var K=this;if(this.opts.dnd&&this.opts.dndDrag&&OSjs.Compability.dnd){this.onCreateItem=function(N,O,M){var L=this;if(O.filename==".."){return}if(O.type==="file"){N.title=([OSjs._("Filename")+": "+O.filename,OSjs._("Path")+": "+O.path,OSjs._("Size")+": "+O.size||0,OSjs._("MIME")+": "+O.mime||"none"]).join("\n");x(N,{type:"file",source:{wid:L.wid},data:{type:"file",filename:O.filename,path:O.path,size:O.size,mime:O.mime}})}else{if(O.type=="dir"){N.title=O.path;I(N,{onItemDropped:function(S,Q,R,P){return L.onItemDropped.call(L,S,Q,R,P)},onFilesDropped:function(S,Q,R,P){return L.onFilesDropped.call(L,S,Q,O,P)}})}}}}};D.prototype.render=function(O,N){if(this.destroyed){return}var M=this;var L=function(P){var Q="status/gtk-dialog-question.png";return j(P.filename,P.mime,P.type,Q)};var K=function(P){if(P.size===""){return""}if(M.humanSize){return OSjs.Utils.humanFileSize(P.size)}return P.size};this.setColumns([{key:"image",title:"",type:"image",callback:L,domProperties:{width:"16"},resizable:false},{key:"filename",title:OSjs._("Filename")},{key:"mime",title:OSjs._("MIME"),domProperties:{width:"150"}},{key:"size",title:OSjs._("Size"),callback:K,domProperties:{width:"80"}},{key:"path",title:OSjs._("Path"),visible:false},{key:"type",title:OSjs._("Type"),visible:false}]);A.prototype.render.apply(this,[O,true])};D.prototype._onColumnClick=function(L,K){A.prototype._onColumnClick.apply(this,arguments);this.onSort(K)};D.prototype._onActivate=function(L,K){var K=A.prototype._onActivate.apply(this,arguments);if(K&&K.path){this.onActivated(K.path,K.type,K.mime)}};D.prototype._onSelect=function(L,K){var K=A.prototype._onSelect.apply(this,arguments);if(K&&K.path){this.onSelected(K,K._element)}};var C=function(N,O){O=O||{};var M=this;var K=[];if(O.mimeFilter){K=O.mimeFilter||null;if(!K||Object.prototype.toString.call(K)!=="[object Array]"){K=[]}}var L={dnd:(typeof O.dnd==="undefined"||O.dnd===true),summary:O.summary||false,humanSize:(typeof O.humanSize==="undefined"||O.humanSize)};this.startViewType=O.viewType||"ListView";this.viewType=null;this.viewOpts=L;this.lastDir=L.path||"/";this.mimeFilter=K;this.typeFilter=O.typeFilter||null;this.wasUpdated=false;this.sortKey=null;this.sortDir=true;this.locked=O.locked||false;this.viewRef=null;this.onActivated=function(R,P,Q){};this.onError=function(P){};this.onFinished=function(){};this.onSelected=function(Q,P){};this.onRefresh=function(){};this.onDropped=function(){console.warn("Not implemented yet!")};this.onContextMenu=function(R,P,Q){};this.onViewContextMenu=function(P){};this.onItemDropped=function(R,P,Q){};this.onColumnSort=function(P){if(P==="image"){P=null}M.setSort(P)};H.apply(this,[N,O])};C.prototype=Object.create(H.prototype);C.prototype.destroy=function(){if(this.viewRef){this.viewRef.destroy();this.viewRef=null}H.prototype.destroy.apply(this,arguments)};C.prototype.init=function(){return H.prototype.init.apply(this,["GUIFileView"])};C.prototype.update=function(){H.prototype.update.apply(this,arguments);this.createView(this.startViewType,this.getRoot())};C.prototype.createView=function(M,K){var L=this;if(M!=this.viewType){if(this.viewRef){this.viewRef.destroy();this.viewRef=null;this.sortKey=null;this.sortDir=true}if(M.toLowerCase()=="listview"){this.viewRef=new D(this,"FileListView",this.viewOpts)}else{if(M.toLowerCase()=="iconview"){this.viewRef=new c(this,"FileIconView",this.viewOpts)}else{if(M.toLowerCase()=="treeview"){this.viewRef=new i(this,"FileTreeView",this.viewOpts)}else{throw"Invalid view type: "+M}}}if(this._window){this.viewRef._setWindow(this._window)}this.viewRef._hooks=this._hooks;this.viewRef.onActivated=function(P,N,O){if(N==="dir"){L.chdir(P)}else{L.onActivated.apply(this,arguments)}};this.viewRef.onSelected=function(){return L.onSelected.apply(this,arguments)};this.viewRef.onDropped=function(){return L.onDropped.apply(this,arguments)};this.viewRef.onContextMenu=function(){return L.onContextMenu.apply(this,arguments)};this.viewRef.onViewContextMenu=function(){return L.onViewContextMenu.apply(this,arguments)};this.viewRef.onItemDropped=function(){return L.onItemDropped.apply(this,arguments)};this.viewRef.onSort=function(){return L.onColumnSort.apply(this,arguments)};(K||this.$element).appendChild(this.viewRef.getRoot());this.viewType=M;if(!this.rendered){this.viewRef.update()}}};C.prototype.refresh=function(L,M,O){L=L||function(){};M=M||function(){};O=(typeof O!=="undefined")&&(O===true);if(this.viewRef){var K=this.viewRef.$view||{};var N=K.scrollTop;this.chdir(this.getPath(),function(){L.apply(this,arguments);setTimeout(function(){if(K&&O){K.scrollTop=N}},10)},M)}};C.prototype._getDir=function(M,O,N){var L=this;O=O||function(){};N=N||function(){};function K(S,Q,R){if(!Q){return S}var T=null;if(S.length&&S[0].filename===".."){T=S.shift()}var P=S.sort(function(X,V){var W=new Date(X[Q]),U=new Date(V[Q]);if(W<U){return -1}if(W>U){return 1}return 0});if(!R){P.reverse()}if(T){P.unshift(T)}return P}OSjs.API.call("fs",{method:"scandir","arguments":[M,{mimeFilter:this.mimeFilter,typeFilter:this.typeFilter}]},function(T){if(L.destroyed){return}var V=false;var Q=0;var S=0;var U=[];if(T){if(T.error){N.call(L,T.error,M);return}else{if(T.result){if(L.locked){if(T.result.length>0){if(T.result[0].filename==".."){T.result.shift()}}}if(L.summary&&T.result.length){for(var R=0,P=T.result.length;R<P;R++){if(T.result[R].filename!==".."){if(T.result[R].size){S+=(T.result[R].size<<0)}Q++}}}U=L.sortKey?K(T.result,L.sortKey,L.sortDir):T.result}}}O.call(L,U,M,Q,S)},function(P){N.call(L,P,M,true)})};C.prototype.chdir=function(L,K,M){if(this.destroyed){return}K=K||function(){};M=M||function(){};if(!this.viewRef){throw"FileView has no GUI element attached!"}this.onRefresh.call(this);this._getDir(L,function(S,P,O,Q){this.lastDir=P;this.wasUpdated=true;if(this.viewRef){this.viewRef.render(S,P)}this.onFinished(P,O,Q);if(this.viewRef&&this.getViewType()==="ListView"){if(this.sortKey){var N=this.viewRef.$headTop.getElementsByClassName("Column_"+this.sortKey);N=(N&&N.length)?N[0]:null;if(N){var R=document.createElement("div");R.className="Arrow "+(this.sortDir?"Ascending":"Descending");N.firstChild.appendChild(R)}}}K.call(this)},function(P,O,N){this.onError.call(this,P,O,(N||false));M.call(this,P,O,(N||false))})};C.prototype.onDndDrop=function(K){if(this.viewRef){return this.viewRef.onDndDrop(K)}return true};C.prototype.onKeyPress=function(K){if(this.viewRef){return this.viewRef.onKeyPress(K)}return true};C.prototype.focus=function(K){if(H.prototype.focus.apply(this,arguments)){if(this.viewRef){return this.viewRef.focus(K)}}return false};C.prototype.blur=function(K){if(H.prototype.blur.apply(this,arguments)){if(this.viewRef){return this.viewRef.blur(K)}}return false};C.prototype.setViewType=function(K){this.createView(K);if(this.wasUpdated){this.refresh()}};C.prototype.setSort=function(K){if(this.wasUpdated){if(K===this.sortKey){this.sortDir=!this.sortDir}else{this.sortDir=true}this.sortKey=K;this.refresh()}};C.prototype.setSelected=function(L,K){if(this.viewRef){this.viewRef.setSelected.apply(this.viewRef,[L,K,true])}};C.prototype.getPath=function(){return this.lastDir};C.prototype.getSelected=function(){return this.viewRef?this.viewRef.getSelected():null};C.prototype.getViewType=function(){return this.viewType};OSjs.GUI.GUIElement=H;OSjs.GUI.MenuBar=B;OSjs.GUI.ListView=A;OSjs.GUI.FileView=C;OSjs.GUI.Textarea=v;OSjs.GUI.ColorSwatch=n;OSjs.GUI.StatusBar=d;OSjs.GUI.Slider=u;OSjs.GUI.ToolBar=J;OSjs.GUI.Canvas=t;OSjs.GUI.ProgressBar=s;OSjs.GUI.IconView=b;OSjs.GUI.TreeView=f;OSjs.GUI.RichText=z;OSjs.GUI.Tabs=a;OSjs.GUI.Select=h;OSjs.GUI.SelectList=q;OSjs.GUI.Text=l;OSjs.GUI.Checkbox=r;OSjs.GUI.Radio=k;OSjs.GUI.Button=F;OSjs.GUI.ScrollView=y;OSjs.GUI.PanedView=w;OSjs.GUI.Label=o;OSjs.GUI.createDraggable=x;OSjs.GUI.createDroppable=I;OSjs.GUI.getFileIcon=j;var e;OSjs.GUI.createMenu=function(K,L){K=K||[];L=L||{x:0,y:0};OSjs.GUI.blurMenu();e=new E(K);e.show(L);return e};OSjs.GUI.blurMenu=function(){if(e){e.destroy();e=null}}})();"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.Handlers=OSjs.Handlers||{};var b=function(c){this.packages={};this.uri=c};b.prototype.load=function(d){var c=this;d=d||{};console.info("PackageManager::load()");OSjs.Utils.Ajax(this.uri,function(f,h,g){if(typeof f==="string"){if(f.match(/^\{/)){try{f=JSON.parse(f)}catch(i){console.warn("FAILED TO FORCE JSON MIME TYPE",i)}}}if(f){c._setPackages(f);d(true)}else{d(false,"No packages found!")}},function(g,e,f){if(f&&f.status!=200){g="Failed to load package manifest from "+uri+" - HTTP Error: "+f.status}d(false,g)},{method:"GET",parse:true})};b.prototype._setPackages=function(c){console.debug("PackageManager::_setPackages()",c);var f=OSjs.Locale.getLocale();var d={};var g;for(var e in c){if(c.hasOwnProperty(e)){g=c[e];if(typeof g.names!=="undefined"){if(g.names[f]){g.name=g.names[f]}}if(typeof g.descriptions!=="undefined"){if(g.descriptions[f]){g.description=g.descriptions[f]}}if(!g.description){g.description=g.name}d[e]=g}}this.packages=d};b.prototype.getPackage=function(c){if(typeof this.packages[c]!=="undefined"){return this.packages[c]}return false};b.prototype.getPackages=function(){return this.packages};b.prototype.getPackagesByMime=function(g){var d,e,c;var f=[];for(e in this.packages){if(this.packages.hasOwnProperty(e)){c=this.packages[e];if(c&&c.mime){for(d=0;d<c.mime.length;d++){if((new RegExp(c.mime[d])).test(g)===true){f.push(e)}}}}}return f};var a=function(){var d=this;var c=OSjs.Settings.DefaultConfig();this.offline=false;this.settings=new OSjs.Helpers.SettingsManager();this.config=c;this.packages=new b(c.Core.PACKAGEURI);this.userData={id:0,username:"root",name:"root user",groups:["root"]};if(typeof navigator.onLine!=="undefined"){window.addEventListener("offline",function(e){d.onOffline()});window.addEventListener("online",function(e){d.onOnline()})}};a.prototype._call=function(e,c,d){if(this.offline){d("You are currently off-line and cannot perform this operation!");return false}return OSjs.Utils.Ajax(this.config.Core.APIURI,function(f,h,g){f=f||{};c.apply(this,arguments)},function(i,f,h,g){d.apply(this,arguments)},e)};a.prototype.callAPI=function(g,c,d,e){c=c||{};console.group("DefaultHandler::callAPI()");console.log("Method",g);console.log("Arguments",c);console.groupEnd();var f={method:"POST",post:{method:g,"arguments":c}};return this._call(f,d,e)};a.prototype.onOnline=function(){console.warn("DefaultHandler::onOnline()","Going online...");this.offline=false;var c=OSjs.API.getWMInstance();if(c){c.notification({title:"Warning!",message:"You are Offline!"})}};a.prototype.onOffline=function(){console.warn("DefaultHandler::onOffline()","Going offline...");this.offline=true;var c=OSjs.API.getWMInstance();if(c){c.notification({title:"Warning!",message:"You are On-line!"})}};a.prototype.onInitialized=function(){console.debug("OSjs::DefaultHandler::onInitialized()")};a.prototype.init=function(c){console.info("OSjs::DefaultHandler::init()");OSjs.Locale.setLocale(this.config.Core.Locale);c()};a.prototype.destroy=function(){var c=this;if(typeof navigator.onLine!=="undefined"){window.removeEventListener("offline",function(d){c.onOffline()});window.removeEventListener("online",function(d){c.onOnline()})}};a.prototype.boot=function(c){console.info("OSjs::DefaultHandler::boot()");this.packages.load(function(){c(true)})};a.prototype.login=function(e,c,d){console.info("OSjs::DefaultHandler::login()",e);d(true)};a.prototype.logout=function(c,d){console.info("OSjs::DefaultHandler::logout()");if(c!==null){this.setUserSession(c,function(){d(true)});return}d(true)};a.prototype.loadSession=function(c){console.info("OSjs::DefaultHandler::loadSession()");c=c||function(){};this.getUserSession(function(e){if(e){var f=[];for(var d=0;d<e.length;d++){f.push({name:e[d].name,args:e[d].args,data:{windows:e[d].windows||[]}})}OSjs.API.launchList(f,function(j,q,o,h,p){var n=((p||{}).windows)||[];var s,g;for(var m=0,k=n.length;m<k;m++){g=n[m];s=j._getWindow(g.name);if(s){s._move(g.position.x,g.position.y,true);s._resize(g.dimension.w,g.dimension.h,true);console.info("DefaultHandler::loadSession()->onSuccess()",'Restored window "'+g.name+'" from session')}}},null,c)}})};a.prototype.getApplicationMetadata=function(c){return this.packages.getPackage(c)};a.prototype.getApplicationsMetadata=function(){return this.packages.getPackages()};a.prototype.getApplicationNameByMime=function(c,g,d,f){var e=this.packages;this.getSetting("defaultApplication",c,function(h){console.debug("OSjs::DefaultHandler::getApplicationNameByMime()","default application",h);if(!d&&h){if(e.getPackage(h)){f([h]);return}}f(e.getPackagesByMime(c))})};a.prototype.setDefaultApplication=function(c,d,e){e=e||function(){};console.debug("OSjs::DefaultHandler::setDefaultApplication()",c,d);this.setSetting("defaultApplication",c,d,e)};a.prototype.saveSettings=function(c){console.debug("OSjs::DefaultHandler::saveSettings()");c.call(this,true)};a.prototype.setSetting=function(f,c,g,i,e,h){e=(typeof e==="undefined"||e===true);i=i||function(){};var d=this.settings.set(f,c,g,h);if(e){this.saveSettings(function(){i.call(this,d)})}else{i.call(this,d)}};a.prototype.getSetting=function(e,d,f,c){f=f||function(){};f.call(this,this.settings.get(e,d,c))};a.prototype.setUserSettings=function(d,c,f){f=f||function(){};if(typeof d==="object"){for(var e in d){if(d.hasOwnProperty(e)){this.setSetting("userSettings",e,d[e],null,false)}}this.saveSettings(function(){f.call(this,true)})}else{this.setSetting("userSettings",d,c,f)}};a.prototype.getUserSettings=function(c,d){d=d||function(){};this.getSetting("userSettings",c,d)};a.prototype.setUserSession=function(c,d){d=d||function(){};this.setSetting("userSession",null,c,d,true,false)};a.prototype.getUserSession=function(c){c=c||function(){};this.getSetting("userSession",null,c)};a.prototype.setApplicationSettings=function(d,c,e){e=e||function(){};this.setSetting(d,null,c,e,true,false)};a.prototype.getApplicationSettings=function(c,d){d=d||function(){};this.getSetting(c,null,d)};a.prototype.getConfig=function(c){return c?this.config[c]:this.config};a.prototype.getUserData=function(){return this.userData};a.prototype.getSettings=function(){return this.settings};a.prototype.getApplicationResource=function(e,d){var c=((e instanceof OSjs.Core.Process))?(e.__path||""):e;return"/"+c+"/"+d};a.prototype.getThemeResource=function(d,g,c){d=d||null;g=g||null;c=c||null;if(d){var h=OSjs.API.getWMInstance();var i=(h?h.getSetting("theme"):"default")||"default";if(!d.match(/^\//)){if(g=="icon"){var e=c||"16x16";d="/themes/"+i+"/icons/"+e+"/"+d}else{if(g=="sound"){var f="oga";if(!OSjs.Compability.audioTypes.ogg){f="mp3"}d="/themes/"+i+"/sounds/"+d+"."+f}else{if(g=="wm"){d="/themes/"+i+"/wm/"+d}else{if(g=="base"){d="/themes/"+i+"/"+d}}}}}}return d};a.prototype.getIcon=function(d,e,c){if(d.match(/\.\//)){if((e instanceof OSjs.Core.Application)||(typeof e==="string")){return OSjs.API.getApplicationResource(e,d)}else{if(typeof e==="object"){return OSjs.API.getApplicationResource(e.path,d)}}}return OSjs.API.getThemeResource(d,"icon",c)};a.prototype.getThemeCSS=function(c){if(c===null){return"/frontend/blank.css"}return"/themes/"+c+".css"};a.prototype.getResourceURL=function(c){c=c||"";if(c.match(/^osjs\:\/\//)){return c.replace(/^osjs\:\/\//,"")}var d=this.getConfig("Core").FSURI;return c?(d+c):d};OSjs.Handlers.Default=a})();"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.Helpers=OSjs.Helpers||{};var f=OSjs.Core.Application;var b=OSjs.Core.Window;var e=function(g,h,i){b.apply(this,arguments);this._properties.allow_drop=true};e.prototype=Object.create(b.prototype);e.prototype.checkChanged=function(){return false};e.prototype._onDndEvent=function(j,h,i,g){if(!b.prototype._onDndEvent.apply(this,arguments)){return}if(h==="itemDrop"&&i){var k=i.data;if(k&&k.type==="file"&&k.mime){this._appRef.defaultAction("open",k.path,k.mime)}}};e.prototype._close=function(){var g=this;var h=function(){g._close()};if(this.checkChanged(h)!==false){return false}return b.prototype._close.apply(this,arguments)};var a=function(){f.apply(this,arguments);this.currentFile={path:null,mime:null};this.defaultFilename="New file";this.defaultMime=null;this.acceptMime=null;this.defaultActionError=function(){};this.defaultActionSuccess=function(){};this.defaultActionWindow=null;this.allowedActions=["new","open","save","saveas"];this.openAction="raw";this.getSaveData=function(){return null}};a.prototype=Object.create(f.prototype);a.prototype.setCurrentFile=function(g,h){this.currentFile.path=g||null;this.currentFile.mime=h||null;this._setArgument("file",this.currentFile.path);this._setArgument("mime",this.currentFile.mime)};a.prototype.init=function(g,i){f.prototype.init.apply(this,arguments);var h=this._getArgument("file");var j=this._getArgument("mime");if(h){this.defaultAction("open",h,j)}};a.prototype._onMessage=function(h,i,g){f.prototype._onMessage.apply(this,arguments);if(this.defaultActionWindow){if(i=="destroyWindow"&&h._name===this.defaultActionWindow){this.destroy()}}};a.prototype.defaultConfirmClose=function(g,h,i){h=h||"Quit without saving?";g._toggleDisabled(true);this._createDialog("Confirm",[h,function(j){g._toggleDisabled(false);if(j=="ok"){i()}}]);return true};a.prototype.defaultAction=function(k,g,h){var q=this;var m=this.defaultActionWindow?this._getWindow(this.defaultActionWindow):null;if(!k){throw"Action was expected..."}if(k&&!OSjs.Utils.inArray(this.allowedActions,k)){throw"Unsupported action given: "+k}var l=function(r,s){q.defaultActionError(r,s)};var n=function(){q.setCurrentFile(null,null);q.defaultActionSuccess("new",q.currentFile)};var p=function(u,r){r=r||h;if(r&&(q.acceptMime!==null)){var t=false;for(var s=0;s<q.acceptMime.length;s++){if((new RegExp(q.acceptMime[s])).test(r)!==false){t=q.acceptMime[s];break}}if(!t){l("open",OSjs._("The requested file MIME '{0}' is not accepted by this application.",r||"unknown"));return}}if(q.openAction==="filename"){q.setCurrentFile(u,r);q.defaultActionSuccess("open",q.currentFile);return}OSjs.API.call("fs",{method:"file_get_contents","arguments":[u]},function(v){if(v&&(v.result!==false)){q.setCurrentFile(u,r);q.defaultActionSuccess("open",v.result,q.currentFile);return}l("open",(v&&v.error)?v.error:OSjs._("Fatal error on open file!"))},function(v){l("open",OSjs._("Failed to open file: {0}",u),v)})};var j=function(t,s){s=s||h;var r=q.getSaveData();OSjs.API.call("fs",{method:"file_put_contents","arguments":[t,r]},function(u){if(u&&u.result!==false){q.setCurrentFile(t,s);q.defaultActionSuccess("save",q.currentFile);OSjs.API.getCoreInstance().message("vfs",{type:"write",path:OSjs.Utils.dirname(t),filename:OSjs.Utils.filename(t),source:q.__pid});return}l("save",(u&&u.error)?u.error:OSjs._("Fatal error on save file!"))},function(u){l("save",OSjs._("Failed to save file: {0}",t),u)})};var o=this.currentFile.path?OSjs.Utils.dirname(this.currentFile.path):null;var i=this.currentFile.path?OSjs.Utils.filename(this.currentFile.path):null;switch(k){case"new":n();break;case"open":if(g){p(g,h)}else{if(!m){throw"Cannot show a dialog without assigned Window"}m._toggleDisabled(true);this._createDialog("File",[{type:"open",mime:this.defaultMime,mimes:this.acceptMime,path:o},function(s,t,r){m._toggleDisabled(false);if(s!=="ok"){return}p(t,r)}],m)}break;case"save":if(this.currentFile.path){j(this.currentFile.path,this.currentFile.mime)}break;case"saveas":if(!m){throw"Cannot show a dialog without assigned Window"}m._toggleDisabled(true);this._createDialog("File",[{type:"save",path:o,filename:i,mime:this.defaultMime,mimes:this.acceptMime,defaultFilename:this.defaultFilename},function(s,t,r){m._toggleDisabled(false);if(s!=="ok"){return}j(t,r)}],m);break;default:throw"Invalid action: "+k;break}};function d(h,g){this.defaults={};this.settings={};this.defaultMerge=(typeof g==="undefined"||g===true);this.load(h)}d.prototype.load=function(g){this.defaults={};this.settings={};if(g){this.defaults=JSON.parse(JSON.stringify(g));this.reset()}};d.prototype.reset=function(){this.settings=JSON.parse(JSON.stringify(this.defaults))};d.prototype.set=function(h,g,i,j){if(!g){return this.setCategory(h,i,j)}return this.setCategoryItem(h,g,i,j)};d.prototype.get=function(i,h,g){if(!i){return this.settings}if(!h){return this.getCategory(i,g)}return this.getCategoryItem(i,h,g)};d.prototype._mergeSettings=function(h,g){if(((typeof g)!==(typeof h))&&(!g&&h)){return h}if((typeof g)!==(typeof h)){return g}return OSjs.Utils.mergeObject(h,g)};d.prototype.setCategory=function(g,h,i){console.debug("SettingsManager::setCategory()",g,h);if(typeof i==="undefined"){i=this.defaultMerge}if(i){this.settings[g]=this._mergeSettings(this.settings[g],h)}else{this.settings[g]=h}};d.prototype.setCategoryItem=function(h,g,i,j){console.debug("SettingsManager::setCategoryItem()",h,g,i);if(typeof j==="undefined"){j=this.defaultMerge}if(!this.settings[h]){this.settings[h]={}}if(j){this.settings[h][g]=this._mergeSettings(this.settings[h][g],i)}else{this.settings[h][g]=i}};d.prototype.getCategory=function(h,g){if(typeof this.settings[h]!=="undefined"){return this.settings[h]}return g};d.prototype.getCategoryItem=function(i,h,g){if(typeof this.settings[i]!=="undefined"){if(typeof this.settings[i][h]!=="undefined"){return this.settings[i][h]}}return g};function c(n,m,g,k,l){k=k||[];l=l||function(o,i,q,p){};var j=function(p,i,q,o){if(p!="ok"&&p!="complete"){return}OSjs.API.getCoreInstance().message("vfs",{type:"upload",path:g,filename:i,source:n.__pid});l(g,i,q,o)};if(k&&k.length){for(var h=0;h<k.length;h++){if(m){n._createDialog("FileUpload",[g,k[h],j],m)}else{n.addWindow(new OSjs.Dialogs.FileUpload(g,k[h],j),false)}}}}OSjs.Helpers.DefaultApplication=a;OSjs.Helpers.DefaultApplicationWindow=e;OSjs.Helpers.SettingsManager=d;OSjs.Helpers.UploadFiles=c})();"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.Locale=OSjs.Locale||{};var a="en_US";var b="en_US";var c={};c.en_US={};c.no_NO={"Error opening file":"Feil ved åpning av fil","No window manager is running":"Ingen vinubehandler kjørende","The file '<span>{0}</span>' could not be opened":"Filen '<span>{0}</span>' kunne ikke åpnes","Could not find any Applications with support for '{0}' files":"Klarte ikke finne en Applikasjon som støtter '{0}' filer","Failed to launch Application":"Feil under oppstart av Applikasjon","An error occured while trying to launch: {0}":"En feil skjedde under oppstart av: {0}","The application '{0}' is already launched and allows only one instance!":"Applikasjonen '{0}' kjører allerede, og kun en instans er tillat","Application '{0}' construct failed: {1}":"Applikasjonen '{0}' construct feilet: {1}","Application '{0}' init() failed: {1}":"Applikasjon '{0}' init() feilet: {1}","Application resources missing for '{0}' or it failed to load!":"Applikasjon ressursjer mangler for '{0}' (eller en feil oppstod)","Application '{0}' preloading failed: \n{1}":"Applikasjonen '{0}' preloading feilet: \n{1}","Failed to launch '{0}'. Application manifest data not found!":"Klarte ikke starte '{0}'. Applikasjonsmanifest ikke funnet!","Failed to launch '{0}'. Your browser does not support: {1}":"Klarte ikke starte '{0}'. Din nettleser støtter ikke: {1}","JavaScript Error Report":"JavaScript Feil Oppstod","An unexpected error occured, maybe a bug.":"An uventet feil oppstod, eller en kodefeil","Failed to initialize OS.js":"Klarte ikke starte OS.js","An error occured while initializing OS.js":"En feil skjedde under oppstart av OS.js","Cannot launch OS.js: No window manager defined!":"Klarte ikke starte OS.js: Ingen vinduhåndterer angitt!","Cannot launch OS.js: Failed to launch Window Manager: {0}":"Klarte ikke starte OS.js: Klarte ikke laste vindushåndterer: {0}","Cannot launch OS.js: Failed to preload resources...":"Klarte ikke starte OS.js: Klarte ikke preloade ressursjer...","Application API error":"Applikasjon API Feil","Application {0} failed to perform operation '{1}'":"Applikasjonen {0} klarte ikke utføre operasjon '{1}'","The requested file MIME '{0}' is not accepted by this application.":"Denne applikasjonen støtter ikke filer med denne MIME-typen '{0}'","Fatal error on open file!":"Fatal feil under åpning av fil!","Failed to open file: {0}":"Klarte ikke åpne filen: {0}","Fatal error on save file!":"Fatal feil under lagring av fil!","Failed to save file: {0}":"Klarte ikke lagre filen: {1}","Choose Application":"Velg Applikasjon","Choose an application to open":"Velg en applikasjon for åpning","You need to select an application":"Du må velge en applikasjon","Use as default application for {0}":"Bruk som standard for {0}","File Operation Progress":"Fil-operasjon status","Upload file to <span>{0}</span>.<br />Maximum size: {1} bytes":"Last opp til <span>{0}</span>.<br />Maks størrelse: {1} bytes","Upload Dialog":"Opplasting dialog","Uploading file...":"Laster opp fil...","Uploading '{0}' ({1} {2}) to {3}":"Laster opp '{0}' ({1} {2}) til {3}","Upload failed":"Opplasting feilet","The upload has failed":"Opplastingen har feilet","Reason unknown...":"Ukjent årsak...","Cancelled by user...":"Avbrutt av bruker...","FileDialog Error":"Fil Dialog Feil","Failed listing directory '{0}' because an error occured":"Klarte ikke liste mappen '{0}' fordi en feil oppstod","Are you sure you want to overwrite the file '{0}'?":"Er du sikker på at du vil overskrive filen '{0}'?","You need to select a file or enter new filename!":"Du må velge en fil eller skrive inn et navn!","You need to select a file!":"Du må velge en fil!","File Information":"Fil-informasjon","Loading file information for: {0}":"Laster fil-informasjon for: {0}","FileInformationDialog Error":"File-informasjon Dialog Feil","Failed to get file information for <span>{0}</span>":"Klarte ikke hente fil-informasjon for <span>{0}</span>","Failed to get file information for: {0}":"Klarte ikke hente fil-informasjon for: {0}","Alert Dialog":"Advarsel Dialog","Confirm Dialog":"Konfirmasjons-dialog","Input Dialog":"Inndata-dialog","Color Dialog":"Farge-dialog","Red: {0}":"Rød: {0}","Green: {0}":"Grønn: {0}","Blue: {0}":"Blå: {0}","Alpha: {0}":"Alpha: {0}","Font Dialog":"Skriftype-dialog","{0} Application Error":"{0} Applikasjon Feil","Failed to perform action '{0}'":"Klarte ikke utføre '{0}'","Failed to save file (call): {0}":"Klarte ikke lagre filen (call): {0}","Cannot open file":"Kan ikke åpne filen","Not supported!":"Ikke støttet!","Unknown Error":"Unkjent Feil","Failed to open file (call): {0}":"Klarte ikke åpne filen (call): {0}","An error occured while handling your request":"En feil oppstod under handling av din forespursel","Fatal error: {0}":"Fatal feil: {0}","An error occured in action: {0}":"En feil oppstod under forespursel: {0}","Discard current document ?":"Forkaste gjeldende dokument ?",Minimize:"Minimiser",Maximize:"Maksimiser",Restore:"Gjenopprett","On Top - Disable":"På Topp - Skru av","On Top - Enable":"På Topp - Skru på",Application:"Applikasjon",Settings:"Instillinger","Log out (Exit)":"Logg ut (Avslutt)","Loading...":"Laster...",Message:"Melding",Summary:"Oppsummering",Trace:"Trace",Name:"Navn",Save:"Lagre",Open:"Åpne",Close:"Lukk",Cancel:"Avbryt",OK:"OK",Filename:"Filnavn",Type:"Type",MIME:"MIME",Path:"Sti",Size:"Størrelse",Index:"Indeks",Bugreport:"Meld feil",File:"Fil",Add:"Legg til",New:"Ny","Save As...":"Lagre Som...","Create directory":"Opprett mappe",Edit:"Rediger",View:"Visning",Upload:"Last opp",Rename:"Navngi",Delete:"Slett",Information:"Informasjon","Open With...":"Åpne Med...","List View":"Liste-visning","Icon View":"Ikon-visning",Refresh:"Gjennoppfrisk","View type":"Visnings type",PID:"PID",Alive:"Levetid",Undo:"Angre",Redo:"Gjenta",Copy:"Kopier",Paste:"Lim inn",Cut:"Klipp ut",Unlink:"Fjern lenke","Ordered List":"Sortert liste","Unordered List":"Usortert liste",Image:"Bilde",Link:"Lenke",Insert:"Sett inn",Bold:"Fet",Italic:"Kursiv",Underline:"Understrek",Skrike:"Gjennomstrek",Left:"Venstre",Center:"Sentrert",Right:"Høyre",Indent:"Indenter",Outdent:"Utdenter","Text Color":"Tekst farge","Back Color":"Bakgrunns farge","Fatal error":"Fatal feil","Reset to defaults":"Nullstill til standard",Panels:"Panel",Theme:"Tema",Color:"Farge",Font:"Skrift-type","Background Image":"Bakgrunn Bilde","Background Color":"Bakgrunn Farge",Apply:"Bruk",Locales:"Lokalisering",Top:"Topp",Bottom:"Bunn",Yes:"Ja",No:"Nei"};c.de_DE={"Error opening file":"Fehler beim Öffnen der Datei","No window manager is running":"Es wird kein Fenster-Manager ausgeführt","The file '<span>{0}</span>' could not be opened":"Die Datei '<span>{0}</span>' kann nicht geöffnet werden","Could not find any Applications with support for '{0}' files":"Keine Anwendung gefunden, die den Datentyp '{0}' unterstützt","Failed to launch Application":"Fehler beim Starten der Anwendung","An error occured while trying to launch: {0}":'Ein Fehler ist aufgetreten, während des Versuchs "{0}" zu starten',"The application '{0}' is already launched and allows only one instance!":"Anwendung '{0}' ist bereits gestartet und erlaubt nur eine Instanz","Application '{0}' construct failed: {1}":"Anwendung '{0}' construct gescheitert: {1}","Application '{0}' init() failed: {1}":"Anwendung '{0}' init() gescheitert: {1}","Application resources missing for '{0}' or it failed to load!":"Anwendungsressourcen fehlen oder wurden nicht geladen für: {0}","Application '{0}' preloading failed: \n{1}":"Anwendung '{0}' preloading gescheitert: \n{1}","Failed to launch '{0}'. Application manifest data not found!":"'{0}' konnte nicht gestartet werden. Anwendungsmanifest nicht gefunden!","Failed to launch '{0}'. Your browser does not support: {1}":"Klarte ikke starte '{0}'. Uw browser ondersteunt geen: {1}","JavaScript Error Report":"JavaScript Fehlerbericht","An unexpected error occured, maybe a bug.":"Ein unerwarteter Fehler ist aufgetreten, möglicherweise ein Bug","Failed to initialize OS.js":"OS.js konnte nicht initialisiert werden","An error occured while initializing OS.js":"Während der Initialisirung von OS.js ist ein Fehler aufgetreten","Cannot launch OS.js: No window manager defined!":"OS.js konnte nicht gestartet werden: Fenster-Manager nicht festgelegt!","Cannot launch OS.js: Failed to launch Window Manager: {0}":"OS.js konnte nicht gestartet werden: Fenster-Manager konnte nicht gestartet werden: {0}","Cannot launch OS.js: Failed to preload resources...":"OS.js konnte nicht gestartet werden: Resourssen konnten nicht vorab geladen werden...","Application API error":"Anwendungs API Fehler","Application {0} failed to perform operation '{1}'":"Anwendung {0} konnte Aktion nicht ausführen '{1}'","The requested file MIME '{0}' is not accepted by this application.":"Die Anwendung unterstützt den folgenden Dateityp '{0}' nicht","Fatal error on open file!":"Schwerwigender Fehler während des Öffnen der Datei!","Failed to open file: {0}":"Datei konnte nicht geöffnet werden: {0}","Fatal error on save file!":"Schwerwigender Fehler während des Speichern der Datei!","Failed to save file: {0}":"Datei konnte nicht gespeichert werden: {1}","Choose Application":"Wählen Sie eine Anwendung","Choose an application to open":"Wählen Sie eine Anwendung zum Öffnen","You need to select an application":"Sie müssen eine Anwendung auswählen","Use as default application for {0}":"Als Standartanwendung für {0} verwenden","File Operation Progress":"Fortschritt","Upload file to <span>{0}</span>.<br />Maximum size: {1} bytes":"Upload nach <span>{0}</span>.<br />Maximale Größe: {1} bytes","Upload Dialog":"Upload-Dialog","Uploading file...":"Datei-Upload...","Uploading '{0}' ({1} {2}) to {3}":"Hochladen von '{0}' ({1} {2}) von {3}","Upload failed":"Upload fehlgeschlagen","The upload has failed":"Der Upload ist fehlgeschlagen","Reason unknown...":"Unbekannter Grund...","Cancelled by user...":"Abbruch durch Benutzer...","FileDialog Error":"Datei-Dialog Fehler","Failed listing directory '{0}' because an error occured":"Verzeichnis '{0}' konnte nicht geöffnet werden","Are you sure you want to overwrite the file '{0}'?":"Sind Sie sicher, dass Sie die Datei '{0}' überschreiben wollen?","You need to select a file or enter new filename!":"Sie müssen eine Datei auswählen oder geben Sie einen neuen Dateinamen an!","You need to select a file!":"Sie müssen eine Datei auswählen!","File Information":"Dateiinformationen","Loading file information for: {0}":"Laster fil-informasjon for: {0}","FileInformationDialog Error":"File-informasjon Dialog Feil","Failed to get file information for <span>{0}</span>":"Klarte ikke hente fil-informasjon for <span>{0}</span>","Failed to get file information for: {0}":"Klarte ikke hente fil-informasjon for: {0}","Alert Dialog":"Warnungsdialog","Confirm Dialog":"Bestätigungsdialog","Input Dialog":"Eingabedialog","Color Dialog":"Farb-Dialog","Red: {0}":"Rot: {0}","Green: {0}":"Grün: {0}","Blue: {0}":"Blau: {0}","Alpha: {0}":"Alpha: {0}","Font Dialog":"Schriftarten-Dialog","{0} Application Error":"{0} Anwendungsfehler","Failed to perform action '{0}'":"Konnte Aktion nicht durchführen: '{0}'","Failed to save file (call): {0}":"Fehler beim Speichern der Datei (call): {0}","Cannot open file":"Datei kann nicht geöffnte werden","Not supported!":"Nicht unterstützt!","Unknown Error":"Unbekannter Fehler","Failed to open file (call): {0}":"Datei kann nicht geöffnte werden (call): {0}","An error occured while handling your request":"Während Ihres Requests ist ein Fehler aufgetreten","Fatal error: {0}":"Schwerwiegender Fehler: {0}","An error occured in action: {0}":"Fehler während Aktion: {0}","Discard current document ?":"Aktuelles Dokument verwerfen?",Minimize:"Minimieren",Maximize:"Maximieren",Restore:"Wiederherstellen","On Top - Disable":"Im Vordergrund - Deaktivieren","On Top - Enable":"Im Vordergrund - Aktivieren",Application:"Anwendung",Settings:"Einstellungen","Log out (Exit)":"Abmelden","Loading...":"Lade...",Message:"Meldung",Summary:"Zusammenfassung",Trace:"Trace",Name:"Name",Save:"Speichern",Open:"Öffnen",Close:"Schließen",Cancel:"Abbrechen",OK:"OK",Filename:"Dateiname",Type:"Type",MIME:"MIME",Path:"Pfad",Size:"Größe",Index:"Index",Bugreport:"Fehlerbericht",File:"Datei",Add:"Hinzufügen",New:"Neu","Save As...":"Speichern unter...","Create directory":"Verzeichnis erstellen",Edit:"Bearbeiten",View:"Ansicht",Upload:"Hochladen",Rename:"Umbenennen",Delete:"Löschen",Information:"Information","Open With...":"Öffnen mit...","List View":"Liste","Icon View":"Symbole",Refresh:"Aktualisieren","View type":"Ansichtstyp",PID:"PID",Alive:"Aktiv",Undo:"Rückgängig",Redo:"Vorwärts",Copy:"Kopieren",Paste:"Einfügen",Cut:"Ausschneiden",Unlink:"Verknüpfung entfernen","Ordered List":"Sortierte Liste","Unordered List":"Unsortierte Liste",Image:"Bild",Link:"Verknüpfung",Insert:"Einfügen",Bold:"Fett",Italic:"Kursiv",Underline:"Unterstrichen",Skrike:"Gjennomstrek",Left:"Links",Center:"Zentriert",Right:"Rechts",Indent:"Einzug",Outdent:"Negativeinzug","Text Color":"Textfarbe","Back Color":"Hintergrundfarbe","Fatal error":"Schwerwiegender Fehler","Reset to defaults":"Werkseinstellungen wiederherstellen",Panels:"Panel",Theme:"Design",Color:"Farbe","Background Image":"Hintergrundbild","Background Color":"Hintergrundfarbe",Font:"Schriftart",Top:"Oben",Bottom:"Unten",Yes:"Ja",No:"Nein",Apply:"Übernehmen",Locales:"Lokalisierung"};OSjs._=function(){var e=arguments[0];var d=arguments;d[0]=c[b][e]||e;return d.length>1?OSjs.Utils.format.apply(null,d):d[0]};OSjs.__=function(){var e=arguments[0];var f=arguments[1];var d=Array.prototype.slice.call(arguments,1);d[0]=e[b]?(e[b][f]||f):f;return d.length>1?OSjs.Utils.format.apply(null,d):d[0]};OSjs.Locale.getLocale=function(){return b};OSjs.Locale.setLocale=function(d){if(c[d]){b=d}else{console.warn("OSjs::Locale::setLocale()","Invalid locale",d,"(Using default)");b=a}console.log("OSjs::Locale::setLocale()",b)}})();"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.Settings=OSjs.Settings||{};window.console=window.console||{};console.log=console.log||function(){};console.debug=console.debug||console.log;console.error=console.error||console.log;console.warn=console.warn||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;var a=function(){var e=function(){return{Core:{APIURI:"/API",FSURI:"/FS",PACKAGEURI:"/packages.json",Home:"/",MaxUploadSize:2097152,BugReporting:true,Preloads:[],Sounds:true,Languages:{en_US:"English",no_NO:"Norsk (Norwegian)",de_DE:"Deutsch (German)"},Locale:"en_US"},Fonts:{"default":"OSjsFont",list:["OSjsFont","Arial","Arial Black","Sans-serif","Serif","Trebuchet MS","Impact","Georgia","Courier New","Comic Sans MS","Monospace","Symbol","Webdings"]},WM:{exec:"CoreWM",args:{themes:[{name:"default",title:"Basic OS.js Theme"},{name:"uncomplicated",title:"Uncomplicated (Gnome Theme)"}],defaults:null}}}};if(OSjs.Settings.DefaultConfig){var f=OSjs.Settings.DefaultConfig();OSjs.Settings.DefaultConfig=function(){return OSjs.Utils.mergeObject(e(),f)}}else{OSjs.Settings.DefaultConfig=e}return e()};var d=function(){a();OSjs._initialize()};var b=function(){OSjs._shutdown(false,true)};var c=window.$||window.jQuery;if(typeof c!=="undefined"){console.warn("Using jQuery initialization");c(window).on("load",d);c(window).on("unload",b)}else{window.onload=d;window.onunload=b}})();"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.Utils=OSjs.Utils||{};OSjs.Utils.Keys={H:72,M:77,R:82,BACKSPACE:8,TAB:9,ENTER:13,ESC:27,LEFT:37,RIGHT:39,UP:38,DOWN:40};OSjs.Utils.format=function(f){var e=Array.prototype.slice.call(arguments,1);var g=/\{(\d+)\}/g;var h=function(i,j){return j in e?e[j]:i};return f.replace(g,h)};OSjs.Utils.mergeObject=function(i,h){for(var g in h){try{if(h[g].constructor==Object){i[g]=OSjs.Utils.mergeObject(i[g],h[g])}else{i[g]=h[g]}}catch(f){i[g]=h[g]}}return i};OSjs.Utils.inArray=function(e,h){for(var g=0,f=e.length;g<f;g++){if(e[g]===h){return true}}return false};OSjs.Utils.getCompability=(function(){var q=!!document.createElement("canvas").getContext?document.createElement("canvas"):null;var l=!!document.createElement("video").canPlayType?document.createElement("video"):null;var g=!!document.createElement("audio").canPlayType?document.createElement("audio"):null;function n(u){var t=false,s="Webkit Moz ms O".split(" "),v=document.createElement("div"),e=null;u=u.toLowerCase();if(v.style[u]){t=true}if(t===false){e=u.charAt(0).toUpperCase()+u.substr(1);for(var r=0;r<s.length;r++){if(v.style[s[r]+e]!==undefined){t=true;break}}}return t}var o=false;if(window.navigator){o=(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}var f={upload:false,fileSystem:(("requestFileSystem" in window)||("webkitRequestFileSystem" in window)),localStorage:(("localStorage" in window)&&window.localStorage!==null),sessionStorage:(("sessionStorage" in window)&&window.sessionStorage!==null),globalStorage:(("globalStorage" in window)&&window.globalStorage!==null),openDatabase:(("openDatabase" in window)&&window.openDatabase!==null),getUserMedia:!!o,socket:(("WebSocket" in window)&&window.WebSocket!==null),worker:(("Worker" in window)&&window.Worker!==null),dnd:("draggable" in document.createElement("span")),touch:("ontouchstart" in window)||(window.DocumentTouch&&document instanceof DocumentTouch),orientation:("onorientationchange" in window),css:{transition:n("transition"),animation:n("animation")},canvas:(!!q),canvasContext:[],webgl:false,svg:(!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect),video:(!!l),videoTypes:{webm:(l&&!!l.canPlayType('video/webm; codecs="vp8.0, vorbis"')),ogg:(l&&!!l.canPlayType('video/ogg; codecs="theora"')),h264:(l&&!!(l.canPlayType('video/mp4; codecs="avc1.42E01E"')||l.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"'))),mpeg:(l&&!!l.canPlayType('video/mp4; codecs="mp4v.20.8"')),mkv:(l&&!!l.canPlayType('video/x-matroska; codecs="theora, vorbis"'))},audio:(!!g),audioTypes:{ogg:(g&&!!g.canPlayType('audio/ogg; codecs="vorbis')),mp3:(g&&!!g.canPlayType("audio/mpeg")),wav:(g&&!!g.canPlayType('audio/wav; codecs="1"'))},richtext:(!!document.createElement("textarea").contentEditable)};if(q){var m=["2d","webgl","experimental-webgl","webkit-3d","moz-webgl"];for(var j=0;j<m.length;j++){try{if(!!q.getContext(m[j])){f.canvasContext.push(m[j])}}catch(h){}}f.webgl=(f.canvasContext.length>1);if(!f.webgl){if("WebGLRenderingContext" in window){f.webgl=true}}}try{var p=new XMLHttpRequest();f.upload=(!!(p&&("upload" in p)&&("onprogress" in p.upload)))}catch(k){}return function(){return f}})();OSjs.Utils.isIE=function(){var e=navigator.userAgent.toLowerCase();return(e.indexOf("msie")!=-1)?parseInt(e.split("msie")[1],10):false};OSjs.Utils.filext=function(f){var e=OSjs.Utils.filename(f).split(".").pop();return e?e.toLowerCase():null};OSjs.Utils.dirname=function(g){var e=g.split("/");e.pop();return e.join("/")};OSjs.Utils.filename=function(e){return(e||"").split("/").pop()};OSjs.Utils.humanFileSize=function(e,h){var i=h?1000:1024;if(e<i){return e+" B"}var f=h?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"];var g=-1;do{e/=i;++g}while(e>=i);return e.toFixed(1)+" "+f[g]};OSjs.Utils.escapeFilename=function(e){return(e||"").replace(/[\|&;\$%@"<>\(\)\+,\*\/]/g,"").trim()};OSjs.Utils.HEXtoRGB=function(f){var e=parseInt(f.replace("#",""),16);return{r:(e&(255<<16))>>16,g:(e&(255<<8))>>8,b:(e&255)}};OSjs.Utils.RGBtoHEX=function(k,j,e){if(typeof k==="object"){j=k.g;e=k.b;k=k.r}if(typeof k==="undefined"||typeof j==="undefined"||typeof e==="undefined"){throw"Invalid RGB supplied to RGBtoHEX()"}var h=[(k).toString(16),(j).toString(16),(e).toString(16)];for(var f in h){if(h.hasOwnProperty(f)){if(h[f].length===1){h[f]="0"+h[f]}}}return"#"+h.join("").toUpperCase()};OSjs.Utils.$=function(e){return document.getElementById(e)};OSjs.Utils.$safeName=function(e){return(e||"").replace(/[^a-zA-Z0-9]/g,"_")};OSjs.Utils.$empty=function(e){while(e.firstChild){e.removeChild(e.firstChild)}};OSjs.Utils.$getStyle=function(e,f){var g="";if(document.defaultView&&document.defaultView.getComputedStyle){g=document.defaultView.getComputedStyle(e,"").getPropertyValue(f)}else{if(e.currentStyle){f=f.replace(/\-(\w)/g,function(h,i){return i.toUpperCase()});g=e.currentStyle[f]}}return g};OSjs.Utils.$position=function(g,f){if(g){if(f){var e={left:0,top:0,width:g.offsetWidth,height:g.offsetHeight};while(true){e.left+=g.offsetLeft;e.top+=g.offsetTop;if(g.offsetParent==f||g.offsetParent===null){break}g=g.offsetParent}return e}return g.getBoundingClientRect()}return null};OSjs.Utils.$index=function(g,f){f=f||g.parentNode;var e=Array.prototype.slice.call(f.children);var h=e.indexOf(g,f);return h};OSjs.Utils.$selectRange=function(g,h,f){if(!g){throw"Cannot select range: missing element"}if(typeof h==="undefined"||typeof f==="undefined"){throw"Cannot select range: mising start/end"}if(g.createTextRange){var e=g.createTextRange();e.collapse(true);e.moveStart("character",h);e.moveEnd("character",f);e.select();g.focus()}else{if(g.setSelectionRange){g.focus();g.setSelectionRange(h,f)}else{if(typeof g.selectionStart!="undefined"){g.selectionStart=h;g.selectionEnd=f;g.focus()}}}};OSjs.Utils.$addClass=function(g,e){if(g&&e){var f=new RegExp("\\s?"+e);if(f.test(g.className)===false){g.className+=(g.className?" ":"")+e}}};OSjs.Utils.$removeClass=function(g,e){if(g&&e){var f=new RegExp("\\s?"+e);if(f.test(g.className)!==false){g.className=g.className.replace(f,"")}}};OSjs.Utils.AjaxUpload=function(h,g,e,i){if(!OSjs.Utils.getCompability().upload){throw"File upload is not supported on your platform"}i=i||{};i.progress=i.progress||function(){};i.complete=i.complete||function(){};i.failed=i.failed||function(){};i.canceled=i.canceled||function(){};var j=new XMLHttpRequest();var f=new FormData();f.append("upload",1);f.append("path",e);f.append("upload",h);j.upload.addEventListener("progress",function(k){i.progress(k)},false);j.addEventListener("load",function(k){i.complete(k)},false);j.addEventListener("error",function(k){i.failed(k)},false);j.addEventListener("abort",function(k){i.canceled(k)},false);j.onreadystatechange=function(k){if(j.readyState===4){if(j.status!==200){var m="Unknown error";try{var l=JSON.parse(j.responseText);if(l.error){m=l.error}}catch(n){if(j.responseText){m=j.responseText}else{m=n}}i.failed(k,m)}}};j.open("POST",OSjs.API.getResourceURL());j.send(f);return j};OSjs.Utils.Ajax=function(h,l,j,i){if(!h){throw"No URL given"}l=l||function(){};j=j||function(){};if(!i){i={}}if(!i.method){i.method="GET"}if(!i.post){i.post={}}if(!i.parse){i.parse=true}var g;if(window.XMLHttpRequest){g=new XMLHttpRequest()}else{if(window.ActiveXObject){try{g=new ActiveXObject("Msxml2.XMLHTTP")}catch(k){try{g=new ActiveXObject("Microsoft.XMLHTTP")}catch(k){}}}}if(!g){alert("Giving up :( Cannot create an XMLHTTP instance");return false}g.onreadystatechange=function(){if(g.readyState===4){var m=g.responseText;var n="";var o=this.getResponseHeader("content-type");if(o==="application/json"){if(i.parse){try{m=JSON.parse(g.responseText)}catch(p){m=null;n="An error occured while parsing: "+p}}}if(g.status===200){l(m,g,h)}else{if(!n&&(o!=="application/json")){n="Backend error: "+(g.responseText||"Fatal Error")}j(n,m,g,h)}}};g.open(i.method,h);if(i.method==="GET"){g.send()}else{var f=i.post;if(!(typeof i.post==="String")){f=(JSON.stringify(i.post))}g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");g.send(f)}return true};var c={};var d=function(g){var e=document.styleSheet||[];if(e.length){for(var f=0;f<e.length;f++){if(e[f].href.indexOf(g)!==-1){return true}}}return false};var b=function(e,m,f){f=f||{};if(typeof f.check==="undefined"){f.check=true}var g=f.interval||50;var i=f.maxTries||10;var h=function(n){c[e]=n;console.info("Preloader->createStyle()",n?"success":"error",e);m(n,e)};if(document.createStyleSheet){document.createStyleSheet(e);h(true)}else{var k=document.createElement("link");k.rel="stylesheet";k.type="text/css";k.href=e;document.getElementsByTagName("head")[0].appendChild(k);if(f.check===false||(typeof document.styleSheet==="undefined")){h(true)}else{if(!d(e)){var l;var j=function(n){if(l){clearInterval(l);l=null}h(n)};l=setInterval(function(){console.debug("Preloader->createStyle()","check",e);if(d(e)){j(true);return}else{if(i<=0){j(false);return}}i--},g)}}}};var a=function(h,i){var e=function(j){c[h]=j;console.info("Preloader->createScript()",j?"success":"error",h);i(j,h)};var f=false;var g=document.createElement("script");g.type="text/javascript";g.charset="utf-8";g.onreadystatechange=function(){if((this.readyState=="complete"||this.readyState=="loaded")&&!f){f=true;e(true)}};g.onload=function(){if(f){return}f=true;e(true)};g.onerror=function(){if(f){return}f=true;e(false)};g.src=h;document.getElementsByTagName("head")[0].appendChild(g)};OSjs.Utils.Preload=function(n,p,h){n=n||[];p=p||function(){};h=h||function(){};var f=[];for(var k=0;k<n.length;k++){f.push(n[k])}var m=f.length;var q=0;var e=0;var l=[];var j=function(){p(m,l.length,l)};var o=function(r,i){e++;h(e,m);if(r){q++}else{l.push(i)}if(f.length){g()}else{j()}};var g=function(){if(f.length){var i=f.shift();if(c[i.src]===true){o(true);return}if(i.type.match(/^style/)){b(i.src,o)}else{if(i.type.match(/script$/)){a(i.src,o)}}}};if(f.length){console.log("Preloader",m,"file(s)",f);g()}else{j()}}})();"use strict";
/*!
 * OS.js - JavaScript Operating System
 *
 * Copyright (c) 2011-2013, Anders Evenrud <andersevenrud@gmail.com>
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met: 
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer. 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution. 
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud <andersevenrud@gmail.com>
 * @licence Simplified BSD License
 */
(function(){window.OSjs=window.OSjs||{};OSjs.Handlers=OSjs.Handlers||{};var a=function(){if(!OSjs.Compability.localStorage){throw"Your browser does not support localStorage :("}this.prefix="OS.js-v2/DemoHandler/"};a.prototype.set=function(d){console.debug("DefaultStorage::set()",d);for(var c in d){if(d.hasOwnProperty(c)){localStorage.setItem(this.prefix+c,JSON.stringify(d[c]))}}};a.prototype.get=function(){var c={};for(var d in localStorage){if(localStorage.hasOwnProperty(d)){if(d.indexOf(this.prefix)===0){c[d.replace(this.prefix,"")]=JSON.parse(localStorage[d])||null}}}return c};var b=function(){OSjs.Handlers.Default.apply(this,arguments);this.storage=new a()};b.prototype=Object.create(OSjs.Handlers.Default.prototype);b.prototype.init=function(e){console.info("OSjs::DemoHandler::init()");var d=this;var c=function(f){OSjs.Locale.setLocale(f||d.config.Core.Locale);if(e){e()}};this.login("demo","demo",function(f){f=f||{};d.userData=f;d.settings.load(d.storage.get());d.getUserSettings("Core",function(h){var g=null;if(h){if((typeof h.Locale!=="undefined")&&h.Locale){g=h.Locale}}c(g)})})};b.prototype.login=function(f,d,e){console.info("OSjs::DemoHandler::login()",f);if(f==="demo"&&d==="demo"){var c={id:1,username:"demo",name:"Demo User",groups:["demo"]};e.call(this,c);return}e.call(this,false,"Invalid login")};b.prototype.saveSettings=function(d){var c=this.settings.get();console.debug("OSjs::Handlers::DemoHandler::saveSettings()",c);this.storage.set(c);d.call(this,true)};OSjs.Handlers.Current=b})();
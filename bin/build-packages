#!/bin/bash

mkdir dist/packages 2>/dev/null
for r in `find src/packages -type d -maxdepth 1 -mindepth 1`; do

  repo=$(basename $r)
  echo -e "\033[1;34mFound repository '$repo':\033[0m"
  mkdir dist/packages/${repo} 2>/dev/null
  for a in `find $r -type d -maxdepth 1`; do
    app=$(basename $a)
    if [ "$app" == ".git" ]; then
      continue
    fi
    if [ "$app" == "$repo" ]; then
      continue
    fi

    echo -e "Copying and combining package '$app'";
    cp -rf ${a} dist/packages/${repo}/${app}
    ./bin/build-package ${repo} ${app}
  done

done
